---
title: "Error Distance Analyses 3b"
author: "Devin Gamble"
date: "11/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Regression Analysis & Comparison of Simulated coordinate data  


#### Comparisons:  

For each one of five replicates, we compare pheno-climatic models of the original data (0-2 km error only) with those from simulated data where coordinates are dispersed by 2, 5, 15, and 25 km. These comparisons include:  

1. Model regression coefficients for long-term and anomalouse MAT and MAP  
2. Model $R^2$ values  
3. Correlations b/w elevation change and climatic change in simulated deviations  


```{r echo = FALSE, message = FALSE, warning = FALSE}
#Load Packages
library(car)
library(tidyverse)
library(here)
library(ggplot2)
library(visreg)
library(jtools)
library(stringr)
```


Load Data  
```{r message = FALSE, warning = FALSE}
nemo_df2 <- read_csv(here::here("data_cleaning", "nemo_full_1901_2019.csv")) %>%  
  mutate(error_bin = as_factor(error_bin)) #Should this be ordered? #Combined specimen & climate data from 1901-2019
#1677 obs, 1251 columns

nemo_df1 <- read_csv(here::here("data_cleaning", "nemo_full_1861_2019.csv")) #Combined data for all years
#1764 obs, 1251 columns

options(contrasts = c("contr.sum", "contr.poly"))
```


```{r message = FALSE, warning = FALSE}
### Data subset by error distances/bins  

#All errors
nemo_all_errors <- nemo_df2 %>% 
  filter(!is.na(error_dist_m)) 
#1239 out of 1764 obs with error distance
#1166 after rm records before 1901

#0-5 km resolution
nemo_e0_5 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km" | error_bin == "2-5 km") 
#0-2 km
nemo_e2 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km") 

nemo_r_2 <- nemo_e2 %>% 
  select(specimen_number:mature_5) #exclude existing climate data

```


**Load Simulated Data**  
```{r message = FALSE}
# 2km Displacement
sims_2km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_2ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3709 obs

# 5km Displacement
sims_5km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_5ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3693 obs

# 15km Displacement
sims_15km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_15ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3630 obs

# 25km Displacement
sims_25km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_25ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3609 obs

```

**Calculated the change in elevation & climate for the replicated data:  
```{r Change in Elev_MAT-MAP, message = FALSE}
### 2km simulations data:

#add nemo_e2 DOY, elev and climate obs to new data

nemo_e2_select <- nemo_e2 %>% 
  select(specimen_number, DOY, elev_m, MAT_100Y, MAP_100Y, MAT_A, MAP_A) %>% 
  rename(MAT_100Y_2k = MAT_100Y, MAP_100Y_2k = MAP_100Y, MAT_A_2k = MAT_A, MAP_A_2k = MAP_A)


#create variables for change in elev, climate
#Also, transform elev and lat/long to standardized names for easier plotting later on

sims_2kma <- left_join(x = sims_2km, y = nemo_e2_select, by = "specimen_number") %>% #5 more rows for elev, four MAT/P variables
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n2k,
         lat = lat_n2k)
#11 new columns in total: 6 for the original 0-2km error data, 5 for the change in these in the simulated data

#NOTE: MAP anomalies are NOT log-transformed!!!


### 5 km simulations
sims_5kma <- left_join(x = sims_5km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n5k,
         lat = lat_n5k)

### 15 km simulations
sims_15kma <- left_join(x = sims_15km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n15k,
         lat = lat_n15k)

### 25 km simulations
sims_25kma <- left_join(x = sims_25km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n25k,
         lat = lat_n25k)


```




### Replicate 1  
 

```{r REP 1a, message = FALSE}
## Long-term Climate
M100Y_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_e2)

M100Y_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_2kma, replicate == "rep1"))
M100Y_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_5kma, replicate == "rep1"))
M100Y_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_15kma, replicate == "rep1"))
M100Y_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(M100Y_lm1, M100Y_2klmR1, M100Y_5klmR1, M100Y_15klmR1, M100Y_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)



#Check out the Adjusted R-squared values
adjrsq <- function(x){
  rsq = getElement(summary.lm(x), "adj.r.squared")
  print(as.numeric(rsq))
}

mod.list <- list(M100Y_lm1, M100Y_2klmR1, M100Y_5klmR1, M100Y_15klmR1, M100Y_25klmR1)
sapply(mod.list, adjrsq)
#Large declines in Rsq after 5km displacement!!!


#With Covariates
M100Y_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + long + year, data = nemo_e2)

M100Y_2klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_2kma, replicate == "rep1"))
M100Y_5klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_5kma, replicate == "rep1"))
M100Y_15klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_15kma, replicate == "rep1"))
M100Y_25klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 1b, message = FALSE}
##Anomalies

MA_lm1 <- lm(DOY ~ MAT_A + MAP_A, data = nemo_e2)

MA_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_2kma, replicate == "rep1"))
MA_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAT_A + MAP_A, data = filter(sims_5kma, replicate == "rep1"))
MA_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAT_A + MAP_A, data = filter(sims_15kma, replicate == "rep1"))
MA_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A +MAT_A + MAP_A, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(MA_lm1, MA_2klmR1, MA_5klmR1, MA_15klmR1, MA_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)



#With Covariates
MA_lm1c <- lm(DOY ~ MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)

MA_2klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep1"))
MA_5klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep1"))
MA_15klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep1"))
MA_25klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 1c, message = FALSE}
### 
# Long-term & Anomalies 
###

MLA_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_e2)
#summ(MLA_lm1, vifs = TRUE)

MLA_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAP_A, data = filter(sims_2kma, replicate == "rep1"))
MLA_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_5kma, replicate == "rep1"))
MLA_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_15kma, replicate == "rep1"))
MLA_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(MLA_lm1, MLA_2klmR1, MLA_5klmR1, MLA_15klmR1, MLA_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#With Covariates
MLA_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep1"))
MLA_5klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep1"))
MLA_15klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep1"))
MLA_25klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 1 reg-plots, message = FALSE}




```

**Control for geography, year from here onwards**  


### Replicate 2  

```{r REP 2a, message = FALSE}
## Long-term Climate

M100Y_lm2 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + long + year, data = nemo_e2)

M100Y_2klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_2kma, replicate == "rep2"))
M100Y_5klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_5kma, replicate == "rep2"))
M100Y_15klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_15kma, replicate == "rep2"))
M100Y_25klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 2b, message = FALSE}
#Anomalies

MA_lm2 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)

MA_2klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep2"))
MA_5klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep2"))
MA_15klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep2"))
MA_25klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 2c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep2"))
MLA_5klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep2"))
MLA_15klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep2"))
MLA_25klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(MLA_lm2c, MLA_2klmR2c, MLA_5klmR2c, MLA_15klmR2c, MLA_25klmR2c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm2c, MLA_2klmR2c, MLA_5klmR2c, MLA_15klmR2c, MLA_25klmR2c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```


### Replicate 3  

```{r REP 3a, message = FALSE}
## Long-term Climate

M100Y_lm3 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + long + year, data = nemo_e2)

M100Y_2klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_2kma, replicate == "rep3"))
M100Y_5klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_5kma, replicate == "rep3"))
M100Y_15klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_15kma, replicate == "rep3"))
M100Y_25klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 3b, message = FALSE}
#Anomalies

MA_lm3 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)

MA_2klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep3"))
MA_5klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep3"))
MA_15klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep3"))
MA_25klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 3c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep3"))
MLA_5klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep3"))
MLA_15klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep3"))
MLA_25klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(MLA_lm3c, MLA_2klmR3c, MLA_5klmR3c, MLA_15klmR3c, MLA_25klmR3c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm3c, MLA_2klmR3c, MLA_5klmR3c, MLA_15klmR3c, MLA_25klmR3c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```


### Replicate 4  

```{r REP 4a, message = FALSE}
## Long-term Climate

M100Y_lm4 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + long + year, data = nemo_e2)

M100Y_2klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_2kma, replicate == "rep4"))
M100Y_5klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_5kma, replicate == "rep4"))
M100Y_15klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_15kma, replicate == "rep4"))
M100Y_25klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 4b, message = FALSE}
#Anomalies

MA_lm4 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)

MA_2klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep4"))
MA_5klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep4"))
MA_15klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep4"))
MA_25klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 4c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep4"))
MLA_5klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep4"))
MLA_15klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep4"))
MLA_25klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(MLA_lm4c, MLA_2klmR4c, MLA_5klmR4c, MLA_15klmR4c, MLA_25klmR4c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm4c, MLA_2klmR4c, MLA_5klmR4c, MLA_15klmR4c, MLA_25klmR4c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


```


### Replicate 5  

```{r REP 5a, message = FALSE}
## Long-term Climate

M100Y_lm5 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + long + year, data = nemo_e2)

M100Y_2klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_2kma, replicate == "rep5"))
M100Y_5klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_5kma, replicate == "rep5"))
M100Y_15klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_15kma, replicate == "rep5"))
M100Y_25klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 5b, message = FALSE}
#Anomalies

MA_lm5 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)

MA_2klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep5"))
MA_5klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep5"))
MA_15klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep5"))
MA_25klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 5c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_2kma, replicate == "rep5"))
MLA_5klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_5kma, replicate == "rep5"))
MLA_15klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_15kma, replicate == "rep5"))
MLA_25klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(MLA_lm5c, MLA_2klmR5c, MLA_5klmR5c, MLA_15klmR5c, MLA_25klmR5c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm5c, MLA_2klmR5c, MLA_5klmR5c, MLA_15klmR5c, MLA_25klmR5c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)



```

Trends in slope estimates of anomalies potentially tied to reduced effects of elevation (or long)?  
<br>  




### AVERAGE among replicates  

```{r}
#Average long-term and anomalous MAT, MAP by Replicate 

nemo_2ksim_avg <- group_by(nemo_2kmsims, specimen_number) %>% 
  summarize



```





### Differences among replicates, within simulation groups  


## Change in Elevation & Climate  

Compare differences in magnitude of change (esp. climate) b/w norms and anomalies.  



