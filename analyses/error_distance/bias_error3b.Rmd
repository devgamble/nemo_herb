---
title: "Error Distance Analyses 3b"
author: "Devin Gamble"
date: "11/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Regression Analysis & Comparison of Simulated coordinate data  


#### Comparisons:  

For each one of five replicates, we compare pheno-climatic models of the original data (0-2 km error only) with those from simulated data where coordinates are dispersed by 2, 5, 15, and 25 km. These comparisons include:  

1. Model regression coefficients for long-term and anomalous MAT and MAP  
2. Model $R^2$ values  
3. Correlations b/w elevation change and climatic change in simulated deviations  

Additional comparison: Model structure (including anomalies and long-term conditions; including vs excluding additional covariates)

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Load Packages
library(car)
library(tidyverse)
library(here)
library(ggplot2)
library(visreg)
library(jtools)
library(stringr)
```


Load Data  
```{r message = FALSE, warning = FALSE}
nemo_df2 <- read_csv(here::here("data_cleaning", "nemo_full_1901_2019.csv")) %>%  
  mutate(error_bin = as_factor(error_bin)) #Should this be ordered? #Combined specimen & climate data from 1901-2019
#1677 obs, 1251 columns

nemo_df1 <- read_csv(here::here("data_cleaning", "nemo_full_1861_2019.csv")) #Combined data for all years
#1764 obs, 1251 columns

options(contrasts = c("contr.sum", "contr.poly"))
```


```{r message = FALSE, warning = FALSE}
### Data subset by error distances/bins  

#All errors
nemo_all_errors <- nemo_df2 %>% 
  filter(!is.na(error_dist_m)) 
#1239 out of 1764 obs with error distance
#1166 after rm records before 1901

#0-5 km resolution
nemo_e0_5 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km" | error_bin == "2-5 km") 
#0-2 km
nemo_e2 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km") 

nemo_r_2 <- nemo_e2 %>% 
  select(specimen_number:mature_5) #exclude existing climate data

```


**Load Simulated Data**  
```{r message = FALSE}
# 2km Displacement
sims_2km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_2ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3709 obs

# 5km Displacement
sims_5km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_5ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3693 obs

# 15km Displacement
sims_15km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_15ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3630 obs

# 25km Displacement
sims_25km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_25ka_all.csv")) %>%   
  mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
                 PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) #log-transform long-term MAP
#3609 obs

```

**Calculated the change in elevation & climate for the replicated data:  
```{r Change in Elev_MAT-MAP, message = FALSE}
### 2km simulations data:

#add nemo_e2 DOY, elev and climate obs to new data

nemo_e2_select <- nemo_e2 %>% 
  select(specimen_number, DOY, elev_m, MAT_100Y, MAP_100Y, MAT_A, MAP_A) %>% 
  rename(MAT_100Y_2k = MAT_100Y, MAP_100Y_2k = MAP_100Y, MAT_A_2k = MAT_A, MAP_A_2k = MAP_A)


#create variables for change in elev, climate
#Also, transform elev and lat/long to standardized names for easier plotting later on

sims_2kma <- left_join(x = sims_2km, y = nemo_e2_select, by = "specimen_number") %>% #5 more rows for elev, four MAT/P variables
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n2k,
         lat = lat_n2k)
#11 new columns in total: 6 for the original 0-2km error data, 5 for the change in these in the simulated data

#NOTE: MAP anomalies are NOT log-transformed!!!


### 5 km simulations
sims_5kma <- left_join(x = sims_5km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n5k,
         lat = lat_n5k)

### 15 km simulations
sims_15kma <- left_join(x = sims_15km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n15k,
         lat = lat_n15k)

### 25 km simulations
sims_25kma <- left_join(x = sims_25km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n25k,
         lat = lat_n25k)

#vectoriz-able function for adjRsqs
adjrsq <- function(x){
  rsq = getElement(summary.lm(x), "adj.r.squared")
  print(as.numeric(rsq))
}

```




### Replicate 1  
 
Set to only evaluate chunks (reps) w/ full model (100Y and anomalies)

```{r REP 1a, message = FALSE, eval = FALSE}
## Long-term Climate
M100Y_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_e2)

M100Y_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_2kma, replicate == "rep1"))
M100Y_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_5kma, replicate == "rep1"))
M100Y_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_15kma, replicate == "rep1"))
M100Y_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(M100Y_lm1, M100Y_2klmR1, M100Y_5klmR1, M100Y_15klmR1, M100Y_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "errorD", "_.png"), width = 6, height = 4)



#Check out the Adjusted R-squared values
mod.list <- list(M100Y_lm1, M100Y_2klmR1, M100Y_5klmR1, M100Y_15klmR1, M100Y_25klmR1)
sapply(mod.list, adjrsq)
#Large declines in Rsq after 5km displacement!!!


#With Covariates
M100Y_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long + year, data = nemo_e2)

M100Y_2klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep1"))
M100Y_5klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep1"))
M100Y_15klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep1"))
M100Y_25klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_100Y_r1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c, model.names = c("Original (0-2 km error)", "2 km sims", "5 km sims", "15 km sims", "25 km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_100Y_r1c.png"), width = 6, height = 4)
```


```{r REP 1b, message = FALSE, eval = FALSE}
##Anomalies

MA_lm1 <- lm(DOY ~ MAT_A + MAP_A, data = nemo_e2)

MA_2klmR1 <- lm(DOY ~ MAT_A + MAP_A, data = filter(sims_2kma, replicate == "rep1"))
MA_5klmR1 <- lm(DOY ~ MAT_A + MAT_A + MAP_A, data = filter(sims_5kma, replicate == "rep1"))
MA_15klmR1 <- lm(DOY ~ MAT_A + MAT_A + MAP_A, data = filter(sims_15kma, replicate == "rep1"))
MA_25klmR1 <- lm(DOY ~ MAT_A +MAT_A + MAP_A, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(MA_lm1, MA_2klmR1, MA_5klmR1, MA_15klmR1, MA_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)



#With Covariates
MA_lm1c <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)

MA_2klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep1"))
MA_5klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep1"))
MA_15klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep1"))
MA_25klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_A_r1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_A_r1c.png"), width = 6, height = 4)
```


```{r REP 1c, message = FALSE}
### 
# Long-term & Anomalies 
###

MLA_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_e2)
#summ(MLA_lm1, vifs = TRUE)

MLA_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAP_A, data = filter(sims_2kma, replicate == "rep1"))
MLA_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_5kma, replicate == "rep1"))
MLA_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_15kma, replicate == "rep1"))
MLA_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(MLA_lm1, MLA_2klmR1, MLA_5klmR1, MLA_15klmR1, MLA_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#With Covariates
MLA_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep1"))
MLA_5klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep1"))
MLA_15klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep1"))
MLA_25klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c)
sapply(mod.list, adjrsq)



#Climate only displayed 
##
plot_summs(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c, model.names = c("Original", "2 km sims", "5 km sims", "15 km sims", "25 km sims"), coefs = c("MAT (100Y)" = "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" = "MAT_A", "MAP (Anom.)" = "MAP_A"), legend.title = "Model Data", scale = TRUE, colors = "Rainbow") + theme_bw() + labs(y = "Predictor")
  #scale_color_manual(values = c("#4470D8", "#8AABF0", "#405DAF", "#E1DECD", "#524273"), labels = NULL) #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_full1.png"), width = 6, height = 4)

## Rainbow palette from jtools -- use for figures to denote different simulated data sets

#All covariates
plot_summs(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```




**Model structure comparisons** (Not evaluated)

```{r REP 1 compare, message = FALSE, eval = FALSE}
#Compare estimates b/w 100Y OR Anom. models with 100Y + Anom. models

#OG models
lapply(list(M100Y_lm1c, MA_lm1c, MLA_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_lm1c, MA_lm1c, MLA_lm1c, model.names = c("Long-term", "Anom.", "Both"), scale = TRUE, legend.title = "Original")

#5km sims
lapply(list(M100Y_5klmR1c, MA_5klmR1c, MLA_5klmR1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_5klmR1c, MA_5klmR1c, MLA_5klmR1c, model.names = c("Long-term", "Anom.", "Both"), scale = TRUE, legend.title = "5 km sims")


#25km sims
lapply(list(M100Y_25klmR1c, MA_25klmR1c, MLA_25klmR1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_25klmR1c, MA_25klmR1c, MLA_25klmR1c, model.names = c("Long-term", "Anom.", "Both"), scale = TRUE, legend.title = "25 km sims")

```
It appears that models including **BOTH** the long-term normals and anomalies has little effect with the original data, though the model with both NS weakens the effect of MAT_A while strengthening the effect of PPT_A. Estimates of elevation & longitude are *FLIPPED* b/w the anom. model and the long-term/both model!!!! This is likely due to correlations, and suggests that controlling for long-term conditions when analyzing the effect of geography is *really important*!!


Check whether including vs excluding geog. covariates affects estimates
```{r message = FALSE, eval = FALSE}
#Long-term
lapply(list(M100Y_lm1, M100Y_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_lm1, M100Y_lm1c, model.names = c("Without cov.s", "With cov.s"), scale = TRUE, legend.title = "Long-term")

#Anom.s
lapply(list(MA_lm1, MA_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(MA_lm1, MA_lm1c, model.names = c("Without cov.s", "With cov.s"), scale = TRUE, legend.title = "Anom.s")


#Both
lapply(list(MLA_lm1, MLA_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(MLA_lm1, MLA_lm1c, model.names = c("Without cov.s", "With cov.s"), scale = TRUE, legend.title = "Both")


```

**Long-term** climate predictor estimates *without* controlling for geography/year are stronger for MAP, weaker for MAT. No noticeable difference in anomaly only model. It might be appropriate to compare including vs excluding these covariates in models with both Long-term and anomaly predictors!


Conclusion: From these comparisons, it seems best to use the model with **BOTH** anomalies AND long-term normals to reduce error due to correlations. However, it will likely be useful to continue comparing estimates when geographic predictors (& year) are included vs excluded (and check VIFs).

---

**Control for geography, year from here onwards**  


### Replicate 2  

```{r REP 2a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm2 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long + year, data = nemo_e2)

M100Y_2klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep2"))
M100Y_5klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep2"))
M100Y_15klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep2"))
M100Y_25klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 2b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm2 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)

MA_2klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep2"))
MA_5klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep2"))
MA_15klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep2"))
MA_25klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 2c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep2"))
MLA_5klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep2"))
MLA_15klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep2"))
MLA_25klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(MLA_lm2c, MLA_2klmR2c, MLA_5klmR2c, MLA_15klmR2c, MLA_25klmR2c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm2c, MLA_2klmR2c, MLA_5klmR2c, MLA_15klmR2c, MLA_25klmR2c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```


### Replicate 3  

```{r REP 3a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm3 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long + year, data = nemo_e2)

M100Y_2klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep3"))
M100Y_5klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep3"))
M100Y_15klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep3"))
M100Y_25klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 3b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm3 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)

MA_2klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep3"))
MA_5klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep3"))
MA_15klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep3"))
MA_25klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 3c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep3"))
MLA_5klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep3"))
MLA_15klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep3"))
MLA_25klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(MLA_lm3c, MLA_2klmR3c, MLA_5klmR3c, MLA_15klmR3c, MLA_25klmR3c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm3c, MLA_2klmR3c, MLA_5klmR3c, MLA_15klmR3c, MLA_25klmR3c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```


### Replicate 4  

```{r REP 4a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm4 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long + year, data = nemo_e2)

M100Y_2klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep4"))
M100Y_5klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep4"))
M100Y_15klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep4"))
M100Y_25klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 4b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm4 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)

MA_2klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep4"))
MA_5klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep4"))
MA_15klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep4"))
MA_25klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 4c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep4"))
MLA_5klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep4"))
MLA_15klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep4"))
MLA_25klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(MLA_lm4c, MLA_2klmR4c, MLA_5klmR4c, MLA_15klmR4c, MLA_25klmR4c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm4c, MLA_2klmR4c, MLA_5klmR4c, MLA_15klmR4c, MLA_25klmR4c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


```


### Replicate 5  

```{r REP 5a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm5 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long + year, data = nemo_e2)

M100Y_2klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep5"))
M100Y_5klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep5"))
M100Y_15klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep5"))
M100Y_25klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 5b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm5 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)

MA_2klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep5"))
MA_5klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep5"))
MA_15klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep5"))
MA_25klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 5c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_2kma, replicate == "rep5"))
MLA_5klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_5kma, replicate == "rep5"))
MLA_15klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_15kma, replicate == "rep5"))
MLA_25klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(MLA_lm5c, MLA_2klmR5c, MLA_5klmR5c, MLA_15klmR5c, MLA_25klmR5c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm5c, MLA_2klmR5c, MLA_5klmR5c, MLA_15klmR5c, MLA_25klmR5c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

Overall, the results of the five replicates appear very similar. 
Models (replicates): [MLA_lm1c, MLA_lm2c, MLA_lm3c, MLA_lm4c, MLA_lm5c]


Trends in slope estimates of anomalies potentially tied to reduced effects of elevation (or long)?  
<br>  



### Changes in coefficient estimates, R2 values among simulated coordinate groups
- Calculate differences in estimates, SEs, in differences b/w sim estimates (for *each* replicate?)

Examine how the change in climatic predictors and elevation drive the decrease in R2, the change in estimates of sensitivity

Change variables reflect difference between original and simulated values:

- elev_change 
- MAT_100Y_change 
- MAP_100Y_change 
- MAT_A_change
- MAP_A_change

**Change in Estimates (means & variance) among replicates**  
```{r}
#Differences b/w parameter estimates among simulated records (mean-centered and scaled)

#Table for summarizing changes
param_change <- data.frame()
param_change[1:16,1] <- c(rep("MAT_100Y", 4), rep("MAP_100Y", 4), rep("MAT_A", 4), rep("MAP_A", 4))
param_change[1:16,2] <- rep(c("2 km", "5 km", "15 km", "25 km"), 4)


#MAT_100Y
param_change[1,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 2k sims
param_change[2,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 5k sims
param_change[3,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 15k sims
param_change[4,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 25k sims

colnames(param_change) <- c("param", "contrast", "coef_dif", "SE_dif")
#colnames(param_change) <- c("coef_dif_2", "SE_dif_2", "coef_dif_5", "SE_dif_5", "coef_dif_15", "SE_dif_15", "coef_dif_25", "SE_dif_25")

#MAP_100Y
param_change[5,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 2k sims
param_change[6,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 5k sims
param_change[7,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 15k sims
param_change[8,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 25k sims

#MAT_A
param_change[9,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 2k sims
param_change[10,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 5k sims
param_change[11,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 15k sims
param_change[12,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 25k sims

#MAP_A
param_change[13,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 2k sims
param_change[14,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 5k sims
param_change[15,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 15k sims
param_change[16,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 25k sims


param_change$abs_coef_dif <- abs(param_change$coef_dif)
param_change$abs_SE_dif <- abs(param_change$SE_dif)
param_change$param <- factor(param_change$param, levels = c("MAT_100Y", "MAP_100Y", "MAT_A", "MAP_A"), ordered = TRUE)
param_change$contrast <- factor(param_change$contrast, levels = c("2 km", "5 km", "15 km", "25 km"), ordered = TRUE)

#Add changes in R2 values
param_change$R2_dif <- rep(c(adjrsq(MLA_lm1c) - adjrsq(MLA_2klmR1c), adjrsq(MLA_lm1c) - adjrsq(MLA_5klmR1c), adjrsq(MLA_lm1c) - adjrsq(MLA_15klmR1c), adjrsq(MLA_lm1c) - adjrsq(MLA_25klmR1c)), 4)




#Visualizing changes
#Use same colors as in coeff plot!!!

ggplot(data = param_change) + 
  geom_col(aes(x = param, y = coef_dif, fill = contrast), col = "black") + 
  geom_hline(yintercept = 0, lty = 2) + #for non-abs values
  scale_fill_manual(values = c("#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  scale_x_discrete(labels = c("MAT-100", "MAP-100", "MAT-A", "MAP-A")) +
  facet_wrap(~contrast) +
  theme_bw()

ggplot(data = param_change) + 
  geom_col(aes(x = param, y = -SE_dif, fill = contrast), position = "dodge", col = "black") + 
  scale_x_discrete(labels = c("MAT (100Y)", "MAP (100Y)", "MAT (A)", "MAP (A)")) +
  scale_y_continuous(expand = c(0.02,0)) +
  scale_fill_manual(values = c("#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  geom_hline(yintercept = 0, lty = 1) +
  #facet_wrap(~contrast) +
  labs(fill = "Sim. Data", y = "Change in Estimate SE", x = "Parameter") +
  theme_bw(base_size = 15) + theme(legend.position = c(0.88, 0.7), legend.background = element_rect(colour = 'black', fill = 'white', linetype='solid', size = .5), legend.key.size = unit(.5, "cm"))
ggsave(here::here("analyses", "figs1", "errorD", "sims_SE-Est_change.png"), width = 6.5, height = 4)
## negative sign for y: positive values indicate increase in SE relative to original data estimates
# More intuitive without facet_wrap?

param_R2change <- param_change %>% 
  group_by(contrast) %>% 
  summarize(R2_dif = mean(R2_dif))

ggplot(data = param_R2change) + 
  geom_col(aes(x = contrast, y = -R2_dif, fill = contrast), col = "black", show.legend = FALSE) +
  scale_fill_manual(values = c("#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  geom_hline(yintercept = 0, lty = 2) +
  labs(y = bquote("Adj."~R^2~ "Change"), x = "Simulated Data") +
  theme_bw(base_size = 15)
ggsave(here::here("analyses", "figs1", "errorD", "sims_AdjR2_change.png"), width = 6, height = 4)


```

Negative values indicate the coefficient of the original data is LESS than the coefficient of the simulated data. More intuitive-- have subtraction go the other way.


#### Comparing Variance metrics among data sets
For the change in elevation, MAT/MAP norms and anomalies

**Create a Mega-data frame with all simulations in one table**:  
```{r warning = FALSE, results = 'hide'}
nemo_combinedsims1 <- bind_rows("OG" = nemo_e2, "2km" = sims_2kma, "5km" = sims_5kma, "15km" = sims_15kma, "25km" = sims_25kma, .id = "data_origin")

#Be mindful of the 5 replicates for each record of each simulated dataset

nemo_combinedsims2 <- nemo_combinedsims1 %>% 
  select(data_origin:DOY, replicate, MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_change:MAP_A_change, -c(date_new:day)) %>% #Select only variables to be analyzed
  mutate(replicate = case_when(data_origin != "OG" ~ replicate,
                               data_origin == "OG" ~ "rep1")) %>% # Append dummy replicate to OG data
  filter(replicate == "rep1") %>% #Filter just to rep1 
  mutate(data_origin = factor(data_origin, ordered = TRUE, levels = c("OG", "2km", "5km", "15km", "25km"))) #level order
```


**Compare Variance/SD among simulation groups**:  
```{r warning = FALSE, eval = FALSE}
#There doesn't seem to be any more robust ways to test for differences in variances bw groups than an F-test or Levene's test..

leveneTest(elev_m ~ data_origin, data = filter(nemo_combinedsims2, data_origin %in% c("OG", "25km")))

```


Compare differences in magnitude of change (esp. climate) b/w norms and anomalies.  

**EDA**
```{r message = FALSE, warning = FALSE}
#Note: The scales of SD among parameters greatly differ... comparisons among variables will not be reliable, but comparisons within variables will be

#Table for combining change values
enviro_change <- tibble(.rows = 20, contrast = rep(factor(c("2 km", "5 km", "15 km", "25 km"), levels = c("2 km", "5 km", "15 km", "25 km"), ordered = TRUE), 5), param = c(rep("elev", 4), rep("MAT_100Y", 4), rep("MAP_100Y", 4), rep("MAT_A", 4), rep("MAP_A", 4)), var_sd = NA)


#Variance
lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change))), FUN = var)
#Variance in change variables increases with farther simulated distances

#SD
enviro_change$var_sd[1:4] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change))), FUN = sd))

#Not used here
coeff_var <- function(x){
  X = as.numeric(x)
  cv = 100*(sd(X)/mean(X))
  cv}
#lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change))), FUN = coeff_var) #coefficient of variation
#coeff_var gives weird estimates that don't follow the trend of variance or sd...


#Other Change variables

#MAT_100Y SD
enviro_change$var_sd[5:8] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change))), FUN = sd))

#MAP_100Y SD
enviro_change$var_sd[9:12] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAP_100Y)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAP_100Y)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAP_100Y)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAP_100Y))), FUN = sd))

#MAT_A SD
enviro_change$var_sd[13:16] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_A)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_A)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_A)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_A))), FUN = sd))

#MAP_A SD
enviro_change$var_sd[17:20] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAP_A)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAP_A)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAP_A)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAP_A))), FUN = sd))
```


```{r message = FALSE, warning = FALSE, eval = FALSE}
#Visualizations
## --See more below
ggplot(data = enviro_change %>% filter(param == "elev")) +
  geom_col(aes(x = contrast, y = var_sd))
ggplot(data = enviro_change %>% filter(param == "MAT_100Y")) +
  geom_col(aes(x = contrast, y = var_sd))
ggplot(data = enviro_change %>% filter(param == "MAP_100Y")) + #Negligible change in MAP_100Y sd
  geom_col(aes(x = contrast, y = var_sd))
ggplot(data = enviro_change %>% filter(param == "MAT_A")) +
  geom_col(aes(x = contrast, y = var_sd))
ggplot(data = enviro_change %>% filter(param == "MAP_A")) +
  geom_col(aes(x = contrast, y = var_sd))
```


```{r message = FALSE, warning = FALSE}
#With OG (error =< 2km) data
nemo_e2_c <- nemo_e2 %>% 
  mutate(elev_m_c = scale(elev_m, scale = FALSE),
         MAT_100Y_c = scale(MAT_100Y, scale = FALSE),
         MAP_100Y_c = scale(MAP_100Y, scale = FALSE)#, 
         #MAT_A_c = scale(MAT_A, scale = FALSE), #Anomalies already 0-centered
         #MAP_A_c = scale(MAP_A, scale = FALSE)
         )
lapply((nemo_e2_c %>% select(elev_m_c, MAT_100Y_c, MAP_100Y_c, MAT_A, MAP_A)), FUN = hist)

##Quantify the variability in each of these variables
#SD
as.numeric(lapply(X = c((nemo_e2_c %>% select(elev_m_c, MAT_100Y_c, MAP_100Y_c, MAT_A, MAP_A))), FUN = sd))

#Variance

#CV


###Visualizations
OGsds <- tibble(.rows = 5) %>% 
  mutate(contrast = rep("OG", 5), param = c("elev", "MAT_100Y", "MAP_100Y", "MAT_A", "MAP_A"), var_sd =         
  as.numeric(lapply(X = c((nemo_e2_c %>% select(elev_m_c, MAT_100Y_c, MAP_100Y_c, MAT_A, MAP_A))), FUN = sd)))
#Centered vs non-centered variables: no difference in estimates of variability. Stick w/ non-centered estimates?
##


enviro_change2 = rbind(enviro_change, OGsds)


ggplot(data = filter(enviro_change2, param == "elev")) +
  geom_col(aes(x = contrast, y = var_sd)) +
  labs(title = "Elevation", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggplot(data = filter(enviro_change2, param == "MAT_100Y")) +
  geom_col(aes(x = contrast, y = var_sd)) +
  labs(title = "MAT (100Y)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggplot(data = filter(enviro_change2, param == "MAP_100Y")) +
  geom_col(aes(x = contrast, y = var_sd)) +
  labs(title = "MAP (100Y)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggplot(data = filter(enviro_change2, param == "MAT_A")) +
  geom_col(aes(x = contrast, y = var_sd)) +
  labs(title = "MAT (Anom.)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggplot(data = filter(enviro_change2, param == "MAP_A")) +
  geom_col(aes(x = contrast, y = var_sd)) +
  labs(title = "MAP (Anom.)", y = "Standard Deviation", x = "Data") +
  theme_bw()

```

Generally, variance and SD increase with increasing simulated distances, indicating a greater amount of variability in new coordinates' elevation, long-term AND anomalous climate conditions! Increases in SD with increasing simulation distance are especially apparent for elevation, MAT_100Y and MAT_A.


<br>  

#### Compare Frequency distributions
*Plot overlapping histograms for sd/variance in OG vs simulated ata parameters*

```{r eval = FALSE}
#Individual histograms
#OG data (centered)
lapply((nemo_e2_c %>% select(elev_m, MAT_100Y, MAP_100Y, MAT_A, MAP_A)), FUN = hist)

#Histograms for change in each of the 5 above variables - all centered around 0, as expected
lapply((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #2km sims
lapply((sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #5km sims
lapply((sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #15km sims
lapply((sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #25km sims

```
```{r}

ggplot(data = nemo_combinedsims2) +
  geom_histogram(aes(x = elev_m, fill = data_origin)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic() 

ggplot(data = nemo_combinedsims2) +
  geom_histogram(aes(x = elev_change, fill = data_origin)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic()

#Not very helpful for visualizing differences in variance... stick with bar plots above?


##OG vs 5 km simulations
ggplot(data = filter(nemo_combinedsims2, data_origin == "5km")) +
  geom_histogram(aes(x = elev_change, fill = data_origin)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic()




## vs 15 km simulations



## vs 25 km simulations



```

<br>  


### Correlation among change variables and climate predictors
```{r}
library(corrplot)
corrplot(cor(sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)
#similar results for different replicates...

#5k
corrplot(cor(sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)

#15k
corrplot(cor(sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)

#25k
corrplot(cor(sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)

```

**2km sims:**
Strongly correlated (r >= .65): MAT & MAP_100Y_change & elev_change 

Moderately correlated (0.3 < r < 0.65): MAT_A_change & MAP_A_change; MAT_A & MAT_A_change; MAT/MAP_A_change & elev_change (MAP_A_change & MAP_A r > 0.3 in some replicates)

**Larger sims:**  
Correlations b/w MAT/MAP_100Y & elev_change still strong, but become weaker. Correlation b/w MAT/MAP_A_change & MAT/MAP_A become **much stronger** (over 0.9 for MAT_A), corr w/ elev_change becomes **stronger** (r = .41 to .57)
Anomaly correlations w/ geography (lat, long, elev_m) also become stronger!
Increasing correlation b/w elev_m & elev_change


Conclusion: *Do not include `elev_change` and `MAT/MAP_100Y_change` in the same model!* when trying to interpret their effects. It seems reasonable here to assume that changes in elevation serve as a decent proxy for changes in long-term, chronic climatic conditions.
Correlations among `elev_change` and `MAT/MAP_A_change` are also present but more moderate, stronger w/ larger sim distances. Given strong correlations w/ `MAT/MAP_A`, examine predictive power of change variables alone. Check VIFs for all models.  

<br>  

**Correlations among change variables, change in coeff_estimates/SE by contrast**  
```{r}
sims_change <- merge(param_change, enviro_change, by = c("contrast", "param"))
#Add elevation coeff values to 'param_change' table above?

corrplot(cor(sims_change %>% select(coef_dif, SE_dif, R2_dif, var_sd)), method = "color", addCoef.col = "black", number.cex = .6)

```
Change in R2 values is strongly negatively correlated with changes in coefficient SE! Also, changes in variable standard deviation (with increasing simulation distances) is positively correlated with coefficient differences.

*Double check that nothing funky is happening with these correlations...*

<br>  


## Influence of changes in variables on models with simulated data  
These models will be identical to those evaluated earlier in this Rmd, except now we include:
- elev_change
- MAT_A_change
- MAP_A_change

Examine differences in MAT_A and MAP_A coefficients, which in earlier comparisons became 0 or flipped to positive with greater dispersion distances.

```{r message = FALSE}
#REP 1 
#Use elev_change as a proxy for long-term change (exclude MAT/MAP_100Y_change)

#Just elev change
lmsim_change_1a <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change, data = filter(sims_2kma, replicate == "rep1"))
summ(lmsim_change_1a, scale = TRUE, vif = TRUE)

#Followed by elev_change & MAT/P_A_change
lmsim_change_1b <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change + MAT_A_change + MAP_A_change, data = filter(sims_2kma, replicate == "rep1"))
summ(lmsim_change_1b, scale = TRUE, vif = TRUE) #collinearity with long may be problematic


#5km
lmsim_change_2a <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change, data = filter(sims_5kma, replicate == "rep1"))
summ(lmsim_change_2a, scale = TRUE, vif = TRUE)

lmsim_change_2b <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change + MAT_A_change + MAP_A_change, data = filter(sims_5kma, replicate == "rep1"))
summ(lmsim_change_2b, scale = TRUE, vif = TRUE) 


#15km
lmsim_change_3a <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change, data = filter(sims_15kma, replicate == "rep1"))
summ(lmsim_change_3a, scale = TRUE, vif = TRUE)

lmsim_change_3b <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change + MAT_A_change + MAP_A_change, data = filter(sims_15kma, replicate == "rep1"))
summ(lmsim_change_3b, scale = TRUE, vif = TRUE) #c




#25km 
lmsim_change_4a <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change, data = filter(sims_25kma, replicate == "rep1"))
summ(lmsim_change_4a, scale = TRUE, vif = TRUE)

lmsim_change_4b <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + elev_change + MAT_A_change + MAP_A_change, data = filter(sims_25kma, replicate == "rep1"))
summ(lmsim_change_4b, scale = TRUE, vif = TRUE) 


#PLOT of coefficient estimates for climate predictors controlling for elev_change, MAT-P_A_change:


#PLOT comparing estimates for models including elev_change && elev_change + MAT/P_A_change:

```
General results: Controlling for change in elevation, MAT/P_A from original coords EXPLAINS observed changes in MAT/P_A estimates!! Coefficients return to values similar to the original (&2km dispersed) data at for higher-distance simulations. High collinearity present - see MAT_A, elev_m, long... too many variables in these models?



Change variables alone as predictors
```{r}
#All Reps:
##Note: Not filtering by reps essentially multiplies the sample size by 5... For the purposes of illustrating a trend, is this okay??? As noted at the end of this file, averaging replicates together is a bad idea.
lmsim_change_2k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = sims_2kma)
summ(lmsim_change_2k, scale = TRUE, vif = TRUE)

lmsim_change_5k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = sims_5kma)
summ(lmsim_change_5k, scale = TRUE, vif = TRUE)

lmsim_change_15k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = sims_15kma)
summ(lmsim_change_15k, scale = TRUE, vif = TRUE)

lmsim_change_25k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = sims_25kma)
summ(lmsim_change_25k, scale = TRUE, vif = TRUE)



#Rep 1
lmsim_change_2k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = filter(sims_2kma, replicate == "rep1"))
summ(lmsim_change_2k, scale = TRUE, vif = TRUE)

lmsim_change_5k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = filter(sims_5kma, replicate == "rep1"))
summ(lmsim_change_5k, scale = TRUE, vif = TRUE)

lmsim_change_15k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = filter(sims_15kma, replicate == "rep1"))
summ(lmsim_change_15k, scale = TRUE, vif = TRUE)

lmsim_change_25k <- lm(DOY ~ elev_change + MAT_A_change + MAP_A_change, data = filter(sims_25kma, replicate == "rep1"))
summ(lmsim_change_25k, scale = TRUE, vif = TRUE)

#Estimates in rep1 vs all-reps model are pretty similar, evidence for just reporting estimates from all reps...?

```

As simulated distances get larger, model R2 improves and change variables predict more variation in DOY (estimates significant for elev_change & MAT_A_change)!!! Negative coefficient for MAT_A & elev change variables indicate that increases in climate anomalies and elevation should predict advanced DOY at these new coordinates.





#### Averages among replicates  

**NOTE**: NOT A GOOD IDEA for showing effect on anomalies. Averaged values for Anomalies will be inaccurate - lots of variations among replicates (even in 2 km sims) in anomalous conditions. In addition, averaged simulated coordinates may not accurately reflect deviations from the original point...    

```{r message = FALSE, eval = FALSE}
#Average long-term and anomalous MAT, MAP by Replicate (single values for each specimen number)

nemo_2ksim_avg <- sims_2kma %>% group_by(specimen_number) %>% 
  select(-replicate) %>% 
  summarize(across(everything(), mean))

nemo_5ksim_avg <- sims_5kma %>% group_by(specimen_number) %>% 
  select(-replicate) %>% 
  summarize(across(everything(), mean))

nemo_15ksim_avg <- sims_15kma %>% group_by(specimen_number) %>% 
  select(-replicate) %>% 
  summarize(across(everything(), mean))

nemo_25ksim_avg <- sims_25kma %>% group_by(specimen_number) %>% 
  select(-replicate) %>% 
  summarize(across(everything(), mean))

### 
# Long-term & Anomalies 
###

#With Covariates
MLA_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long + year, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmRAVGc <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_2ksim_avg)
MLA_5klmRAVGc <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_5ksim_avg)
MLA_15klmRAVGc <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_15ksim_avg)
MLA_25klmRAVGc <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_25ksim_avg)

#Adj Rsq
mod.list <- list(MLA_lm1c, MLA_2klmRAVGc, MLA_5klmRAVGc, MLA_15klmRAVGc, MLA_25klmRAVGc)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm1c, MLA_2klmRAVGc, MLA_5klmRAVGc, MLA_15klmRAVGc, MLA_25klmRAVGc, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MLA_lm1c, MLA_2klmRAVGc, MLA_5klmRAVGc, MLA_15klmRAVGc, MLA_25klmRAVGc, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

