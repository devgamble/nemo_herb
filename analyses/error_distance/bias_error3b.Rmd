---
title: "Error Distance Analyses 3b"
author: "Devin Gamble"
date: "11/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Regression Analysis & Comparison of Simulated coordinate data  


#### Comparisons:  

For each one of five replicates, we compare pheno-climatic models of the original data (0-2 km error only) with those from simulated data where coordinates are dispersed by 2, 5, 15, and 25 km. These comparisons include:  

1. Model regression coefficients for long-term and anomalous MAT and MAP  
2. Model $R^2$ values  
3. Correlations b/w elevation change and climatic change in simulated deviations  

Additional comparison: Model structure (including anomalies and long-term conditions; including vs excluding additional covariates)

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Load Packages
library(car)
library(tidyverse)
library(here)
library(ggplot2)
library(visreg)
library(jtools)
library(stringr)
```


Load Data  
```{r message = FALSE, warning = FALSE}
nemo_df2 <- read_csv(here::here("data_cleaning", "nemo_full_1901_2019.csv")) %>%  
  mutate(error_bin = as_factor(error_bin)) #Should this be ordered? #Combined specimen & climate data from 1901-2019
#1677 obs, 1251 columns

nemo_df1 <- read_csv(here::here("data_cleaning", "nemo_full_1861_2019.csv")) #Combined data for all years
#1764 obs, 1251 columns

options(contrasts = c("contr.sum", "contr.poly"))
```


```{r message = FALSE, warning = FALSE}
### Data subset by error distances/bins  

#All errors
nemo_all_errors <- nemo_df2 %>% 
  filter(!is.na(error_dist_m)) 
#1239 out of 1764 obs with error distance
#1166 after rm records before 1901

#0-5 km resolution
nemo_e0_5 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km" | error_bin == "2-5 km") 
#0-2 km
nemo_e2 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km") 

nemo_r_2 <- nemo_e2 %>% 
  select(specimen_number:mature_5) #exclude existing climate data

```


**Load Simulated Data**  
```{r message = FALSE}
##Un-log-transformed ppt variables!

# 2km Displacement
sims_2km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_2ka_all.csv")) %>%   
  #mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
  #               PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) 
#3709 obs

# 5km Displacement
sims_5km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_5ka_all.csv")) %>%   
  #mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
  #               PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) 
#3693 obs

# 15km Displacement
sims_15km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_15ka_all.csv")) %>%   
  #mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
  #               PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) 
#3630 obs

# 25km Displacement
sims_25km <- read_csv(here::here("analyses", "error_distance", "new_coords", "sims_25ka_all.csv")) %>%   
  #mutate_at(vars(PPT01_100Y:PPT12_100Y, PPT_wt_100Y:PPT_at_100Y, MAP_100Y, MSP_100Y,
  #               PPT01_Y:PPT12_Y, PPT_wt_Y:PPT_at_Y, MAP_Y, MSP_Y), log) %>% 
  na_if(y = -Inf) 
#3609 obs

```

**Calculated the change in elevation & climate for the replicated data:  
```{r Change in Elev_MAT-MAP, message = FALSE}
### 2km simulations data:

#add nemo_e2 DOY, elev and climate obs to new data

nemo_e2_select <- nemo_e2 %>% 
  select(specimen_number, DOY, elev_m, MAT_100Y, MAP_100Y, MAT_A, MAP_A) %>% 
  rename(MAT_100Y_2k = MAT_100Y, MAP_100Y_2k = MAP_100Y, MAT_A_2k = MAT_A, MAP_A_2k = MAP_A)


#create variables for change in elev, climate
#Also, transform elev and lat/long to standardized names for easier plotting later on

sims_2kma <- left_join(x = sims_2km, y = nemo_e2_select, by = "specimen_number") %>% #5 more rows for elev, four MAT/P variables
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n2k,
         lat = lat_n2k)
#11 new columns in total: 6 for the original 0-2km error data, 5 for the change in these in the simulated data

#NOTE: MAP anomalies are NOT log-transformed!!!


### 5 km simulations
sims_5kma <- left_join(x = sims_5km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n5k,
         lat = lat_n5k)

### 15 km simulations
sims_15kma <- left_join(x = sims_15km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n15k,
         lat = lat_n15k)

### 25 km simulations
sims_25kma <- left_join(x = sims_25km, y = nemo_e2_select, by = "specimen_number") %>% 
  mutate(elev_change = elev_m_n - elev_m, 
         MAT_100Y_change = MAT_100Y - MAT_100Y_2k,
         MAP_100Y_change = MAP_100Y - MAP_100Y_2k,
         MAT_A_change = MAT_A - MAT_A_2k,
         MAP_A_change = MAP_A - MAP_A_2k) %>% 
  select(-elev_m) %>% 
  rename(elev_m = elev_m_n,
         long = long_n25k,
         lat = lat_n25k)

#vectoriz-able function for adjRsqs
adjrsq <- function(x){
  rsq = getElement(summary.lm(x), "adj.r.squared")
  print(as.numeric(rsq))
}

```




### Replicate 1  
 
Set to only evaluate chunks (reps) w/ full model (100Y and anomalies)

```{r REP 1a, message = FALSE, eval = FALSE}
## Long-term Climate
M100Y_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_e2)

M100Y_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_2kma, replicate == "rep1"))
M100Y_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_5kma, replicate == "rep1"))
M100Y_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_15kma, replicate == "rep1"))
M100Y_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(M100Y_lm1, M100Y_2klmR1, M100Y_5klmR1, M100Y_15klmR1, M100Y_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "errorD", "_.png"), width = 6, height = 4)



#Check out the Adjusted R-squared values
mod.list <- list(M100Y_lm1, M100Y_2klmR1, M100Y_5klmR1, M100Y_15klmR1, M100Y_25klmR1)
sapply(mod.list, adjrsq)
#Large declines in Rsq after 5km displacement!!!


#With Covariates
M100Y_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long, data = nemo_e2)

M100Y_2klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep1"))
M100Y_5klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep1"))
M100Y_15klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep1"))
M100Y_25klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_100Y_r1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm1c, M100Y_2klmR1c, M100Y_5klmR1c, M100Y_15klmR1c, M100Y_25klmR1c, model.names = c("Original (0-2 km error)", "2 km sims", "5 km sims", "15 km sims", "25 km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_100Y_r1c.png"), width = 6, height = 4)
```


```{r REP 1b, message = FALSE, eval = FALSE}
##Anomalies

MA_lm1 <- lm(DOY ~ MAT_A + MAP_A, data = nemo_e2)

MA_2klmR1 <- lm(DOY ~ MAT_A + MAP_A, data = filter(sims_2kma, replicate == "rep1"))
MA_5klmR1 <- lm(DOY ~ MAT_A + MAT_A + MAP_A, data = filter(sims_5kma, replicate == "rep1"))
MA_15klmR1 <- lm(DOY ~ MAT_A + MAT_A + MAP_A, data = filter(sims_15kma, replicate == "rep1"))
MA_25klmR1 <- lm(DOY ~ MAT_A +MAT_A + MAP_A, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(MA_lm1, MA_2klmR1, MA_5klmR1, MA_15klmR1, MA_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)



#With Covariates
MA_lm1c <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)

MA_2klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep1"))
MA_5klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep1"))
MA_15klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep1"))
MA_25klmR1c <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_A_r1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm1c, MA_2klmR1c, MA_5klmR1c, MA_15klmR1c, MA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_A_r1c.png"), width = 6, height = 4)
```


```{r REP 1c, message = FALSE}
### 
# Long-term & Anomalies 
###

MLA_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_e2)
#summ(MLA_lm1, vifs = TRUE)

MLA_2klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_2kma, replicate == "rep1"))
MLA_5klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_5kma, replicate == "rep1"))
MLA_15klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_15kma, replicate == "rep1"))
MLA_25klmR1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = filter(sims_25kma, replicate == "rep1"))

plot_summs(MLA_lm1, MLA_2klmR1, MLA_5klmR1, MLA_15klmR1, MLA_25klmR1, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#With Covariates
MLA_lm1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep1"))
MLA_5klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep1"))
MLA_15klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep1"))
MLA_25klmR1c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep1"))

#Adj Rsq
mod.list <- list(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c)
sapply(mod.list, adjrsq)



#Climate only displayed 
##
plot_summs(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c, model.names = c("Original", "2 km sims", "5 km sims", "15 km sims", "25 km sims"), coefs = c("MAT (100Y)" = "MAT_100Y", "CAP (100Y)" = "MAP_100Y", "MAT (Anom.)" = "MAT_A", "CAP (Anom.)" = "MAP_A"), legend.title = "Model Data", scale = TRUE, colors = "Rainbow") + theme_bw() + labs(y = "Predictor")
  #scale_color_manual(values = c("#4470D8", "#8AABF0", "#405DAF", "#E1DECD", "#524273"), labels = NULL) #+ scale_x_continuous(limits = c(-15, 10))
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_full1.png"), width = 6, height = 4)

## Rainbow palette from jtools -- use for figures to denote different simulated data sets

#All covariates
plot_summs(MLA_lm1c, MLA_2klmR1c, MLA_5klmR1c, MLA_15klmR1c, MLA_25klmR1c, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```




**Model structure comparisons** (Not evaluated)

```{r REP 1 compare, message = FALSE, eval = FALSE}
#Compare estimates b/w 100Y OR Anom. models with 100Y + Anom. models

#OG models
lapply(list(M100Y_lm1c, MA_lm1c, MLA_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_lm1c, MA_lm1c, MLA_lm1c, model.names = c("Long-term", "Anom.", "Both"), scale = TRUE, legend.title = "Original")

#5km sims
lapply(list(M100Y_5klmR1c, MA_5klmR1c, MLA_5klmR1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_5klmR1c, MA_5klmR1c, MLA_5klmR1c, model.names = c("Long-term", "Anom.", "Both"), scale = TRUE, legend.title = "5 km sims")


#25km sims
lapply(list(M100Y_25klmR1c, MA_25klmR1c, MLA_25klmR1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_25klmR1c, MA_25klmR1c, MLA_25klmR1c, model.names = c("Long-term", "Anom.", "Both"), scale = TRUE, legend.title = "25 km sims")

```
It appears that models including **BOTH** the long-term normals and anomalies has little effect with the original data, though the model with both NS weakens the effect of MAT_A while strengthening the effect of PPT_A. Estimates of elevation & longitude are *FLIPPED* b/w the anom. model and the long-term/both model!!!! This is likely due to correlations, and suggests that controlling for long-term conditions when analyzing the effect of geography is *really important*!!


Check whether including vs excluding geog. covariates affects estimates
```{r message = FALSE, eval = FALSE}
#Long-term
lapply(list(M100Y_lm1, M100Y_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(M100Y_lm1, M100Y_lm1c, model.names = c("Without cov.s", "With cov.s"), scale = TRUE, legend.title = "Long-term")

#Anom.s
lapply(list(MA_lm1, MA_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(MA_lm1, MA_lm1c, model.names = c("Without cov.s", "With cov.s"), scale = TRUE, legend.title = "Anom.s")


#Both
lapply(list(MLA_lm1, MLA_lm1c), summ, vif = TRUE, scale = TRUE)
plot_summs(MLA_lm1, MLA_lm1c, model.names = c("Without cov.s", "With cov.s"), scale = TRUE, legend.title = "Both")


```

**Long-term** climate predictor estimates *without* controlling for geography/year are stronger for MAP, weaker for MAT. No noticeable difference in anomaly only model. It might be appropriate to compare including vs excluding these covariates in models with both Long-term and anomaly predictors!


Conclusion: From these comparisons, it seems best to use the model with **BOTH** anomalies AND long-term normals to reduce error due to correlations. However, it will likely be useful to continue comparing estimates when geographic predictors (& year) are included vs excluded (and check VIFs).

---

**Control for geography, year from here onwards**  


### Replicate 2  

```{r REP 2a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm2 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long, data = nemo_e2)

M100Y_2klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep2"))
M100Y_5klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep2"))
M100Y_15klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep2"))
M100Y_25klmR2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm2, M100Y_2klmR2, M100Y_5klmR2, M100Y_15klmR2, M100Y_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 2b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm2 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)

MA_2klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep2"))
MA_5klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep2"))
MA_15klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep2"))
MA_25klmR2 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm2, MA_2klmR2, MA_5klmR2, MA_15klmR2, MA_25klmR2, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 2c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep2"))
MLA_5klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep2"))
MLA_15klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep2"))
MLA_25klmR2c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep2"))

#Adj Rsq
mod.list <- list(MLA_lm2c, MLA_2klmR2c, MLA_5klmR2c, MLA_15klmR2c, MLA_25klmR2c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm2c, MLA_2klmR2c, MLA_5klmR2c, MLA_15klmR2c, MLA_25klmR2c, model.names = c("Original", "2 km sims", "5 km sims", "15 km sims", "25 km sims"), coefs = c("MAT (100Y)" = "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" = "MAT_A", "MAP (Anom.)" = "MAP_A"), legend.title = "Model Data", scale = TRUE, colors = "Rainbow") + theme_bw() + labs(y = "Predictor")
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_full_rep2.png"), width = 6, height = 4)

```


### Replicate 3  

```{r REP 3a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm3 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long, data = nemo_e2)

M100Y_2klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep3"))
M100Y_5klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep3"))
M100Y_15klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep3"))
M100Y_25klmR3 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm3, M100Y_2klmR3, M100Y_5klmR3, M100Y_15klmR3, M100Y_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 3b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm3 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)

MA_2klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep3"))
MA_5klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep3"))
MA_15klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep3"))
MA_25klmR3 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm3, MA_2klmR3, MA_5klmR3, MA_15klmR3, MA_25klmR3, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 3c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep3"))
MLA_5klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep3"))
MLA_15klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep3"))
MLA_25klmR3c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep3"))

#Adj Rsq
mod.list <- list(MLA_lm3c, MLA_2klmR3c, MLA_5klmR3c, MLA_15klmR3c, MLA_25klmR3c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm3c, MLA_2klmR3c, MLA_5klmR3c, MLA_15klmR3c, MLA_25klmR3c, model.names = c("Original", "2 km sims", "5 km sims", "15 km sims", "25 km sims"), coefs = c("MAT (100Y)" = "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" = "MAT_A", "MAP (Anom.)" = "MAP_A"), legend.title = "Model Data", scale = TRUE, colors = "Rainbow") + theme_bw() + labs(y = "Predictor")
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_full_rep3.png"), width = 6, height = 4)

```


### Replicate 4  

```{r REP 4a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm4 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long, data = nemo_e2)

M100Y_2klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep4"))
M100Y_5klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep4"))
M100Y_15klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep4"))
M100Y_25klmR4 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm4, M100Y_2klmR4, M100Y_5klmR4, M100Y_15klmR4, M100Y_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 4b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm4 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)

MA_2klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep4"))
MA_5klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep4"))
MA_15klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep4"))
MA_25klmR4 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm4, MA_2klmR4, MA_5klmR4, MA_15klmR4, MA_25klmR4, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 4c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep4"))
MLA_5klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep4"))
MLA_15klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep4"))
MLA_25klmR4c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep4"))

#Adj Rsq
mod.list <- list(MLA_lm4c, MLA_2klmR4c, MLA_5klmR4c, MLA_15klmR4c, MLA_25klmR4c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm4c, MLA_2klmR4c, MLA_5klmR4c, MLA_15klmR4c, MLA_25klmR4c, model.names = c("Original", "2 km sims", "5 km sims", "15 km sims", "25 km sims"), coefs = c("MAT (100Y)" = "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" = "MAT_A", "MAP (Anom.)" = "MAP_A"), legend.title = "Model Data", scale = TRUE, colors = "Rainbow") + theme_bw() + labs(y = "Predictor")
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_full_rep4.png"), width = 6, height = 4)

```


### Replicate 5  

```{r REP 5a, message = FALSE, eval = FALSE}
## Long-term Climate

M100Y_lm5 <- lm(DOY ~ MAT_100Y + MAP_100Y  + elev_m + lat + long, data = nemo_e2)

M100Y_2klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep5"))
M100Y_5klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep5"))
M100Y_15klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep5"))
M100Y_25klmR5 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_100Y" = "MAT_100Y", "MAP_100Y" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(M100Y_lm5, M100Y_2klmR5, M100Y_5klmR5, M100Y_15klmR5, M100Y_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)

```

```{r REP 5b, message = FALSE, eval = FALSE}
#Anomalies

MA_lm5 <- lm(DOY ~ MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)

MA_2klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep5"))
MA_5klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep5"))
MA_15klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep5"))
MA_25klmR5 <- lm(DOY ~ MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), coefs = c("MAT_A" = "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)


#All covariates
plot_summs(MA_lm5, MA_2klmR5, MA_5klmR5, MA_15klmR5, MA_25klmR5, model.names = c("Original (0-2km error)", "2km sims", "5km sims", "15km sims", "25km  sims"), scale = TRUE) + theme_bw() #+ scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
```


```{r REP 5c, message = FALSE}
####
# Long-term & Anomalies

#With Covariates
MLA_lm5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A  + elev_m + lat + long, data = nemo_e2)
#summ(MLA_lm1c, vifs = TRUE)

MLA_2klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_2kma, replicate == "rep5"))
MLA_5klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_5kma, replicate == "rep5"))
MLA_15klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_15kma, replicate == "rep5"))
MLA_25klmR5c <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long, data = filter(sims_25kma, replicate == "rep5"))

#Adj Rsq
mod.list <- list(MLA_lm5c, MLA_2klmR5c, MLA_5klmR5c, MLA_15klmR5c, MLA_25klmR5c)
sapply(mod.list, adjrsq)

#Climate only diplayed
plot_summs(MLA_lm5c, MLA_2klmR5c, MLA_5klmR5c, MLA_15klmR5c, MLA_25klmR5c, model.names = c("Original", "2 km sims", "5 km sims", "15 km sims", "25 km sims"), coefs = c("MAT (100Y)" = "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" = "MAT_A", "MAP (Anom.)" = "MAP_A"), legend.title = "Model Data", scale = TRUE, colors = "Rainbow") + theme_bw() + labs(y = "Predictor")
ggsave(here::here("analyses", "figs1", "errorD", "sims_MATMAP_full_rep5.png"), width = 6, height = 4)

```

Overall, the results of the five replicates appear very similar. 
Models (replicates): [MLA_lm1c, MLA_lm2c, MLA_lm3c, MLA_lm4c, MLA_lm5c]


Trends in slope estimates of anomalies potentially tied to reduced effects of elevation (or long)?  
<br>  



### Changes in coefficient estimates, R2 values among simulated coordinate groups
- Calculate differences in estimates, SEs, in differences b/w sim estimates (for *each* replicate?)

Examine how the change in climatic predictors and elevation drive the decrease in R2, the change in estimates of sensitivity

Change variables reflect difference between original and simulated values:

- elev_change 
- MAT_100Y_change 
- MAP_100Y_change 
- MAT_A_change
- MAP_A_change

**Change in Estimates (means & variance) among replicates**  
```{r}
#Differences b/w parameter estimates among simulated records (mean-centered and scaled)

#Table for summarizing changes
param_change <- data.frame()
param_change[1:16,1] <- c(rep("MAT_100Y", 4), rep("MAP_100Y", 4), rep("MAT_A", 4), rep("MAP_A", 4))
param_change[1:16,2] <- rep(c("2 km", "5 km", "15 km", "25 km"), 4)


#MAT_100Y
param_change[1,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 2k sims
param_change[2,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 5k sims
param_change[3,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 15k sims
param_change[4,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[2,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[2,1:2] #OG - 25k sims

colnames(param_change) <- c("param", "contrast", "coef_dif", "SE_dif")
#colnames(param_change) <- c("coef_dif_2", "SE_dif_2", "coef_dif_5", "SE_dif_5", "coef_dif_15", "SE_dif_15", "coef_dif_25", "SE_dif_25")

#MAP_100Y
param_change[5,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 2k sims
param_change[6,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 5k sims
param_change[7,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 15k sims
param_change[8,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[3,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[3,1:2] #OG - 25k sims

#MAT_A
param_change[9,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 2k sims
param_change[10,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 5k sims
param_change[11,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 15k sims
param_change[12,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[4,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[4,1:2] #OG - 25k sims

#MAP_A
param_change[13,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_2klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 2k sims
param_change[14,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_5klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 5k sims
param_change[15,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_15klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 15k sims
param_change[16,3:4] <-  summ(MLA_lm1c, scale = TRUE)$coeftable[5,1:2] - summ(MLA_25klmR1c, scale = TRUE)$coeftable[5,1:2] #OG - 25k sims


param_change$abs_coef_dif <- abs(param_change$coef_dif)
param_change$abs_SE_dif <- abs(param_change$SE_dif)
param_change$param <- factor(param_change$param, levels = c("MAT_100Y", "MAP_100Y", "MAT_A", "MAP_A"), ordered = TRUE)
param_change$contrast <- factor(param_change$contrast, levels = c("2 km", "5 km", "15 km", "25 km"), ordered = TRUE)

#Add changes in R2 values
param_change$R2_dif <- rep(c(adjrsq(MLA_lm1c) - adjrsq(MLA_2klmR1c), adjrsq(MLA_lm1c) - adjrsq(MLA_5klmR1c), adjrsq(MLA_lm1c) - adjrsq(MLA_15klmR1c), adjrsq(MLA_lm1c) - adjrsq(MLA_25klmR1c)), 4)




#Visualizing changes
#Use same colors as in coeff plot!!!

ggplot(data = param_change) + 
  geom_col(aes(x = param, y = coef_dif, fill = contrast), col = "black") + 
  geom_hline(yintercept = 0, lty = 2) + #for non-abs values
  scale_fill_manual(values = c("#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  scale_x_discrete(labels = c("MAT-100", "MAP-100", "MAT-A", "MAP-A")) +
  facet_wrap(~contrast) +
  theme_bw()
#combine this plot with SEs?

ggplot(data = param_change) + 
  geom_col(aes(x = param, y = -SE_dif, fill = contrast), position = "dodge", col = "black", alpha = 0.9) + 
  scale_x_discrete(labels = c("MAT (100Y)", "MAP (100Y)", "MAT (A)", "MAP (A)")) +
  scale_y_continuous(expand = c(0.02,0)) +
  scale_fill_manual(values = c("#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  geom_hline(yintercept = 0, lty = 1) +
  #facet_wrap(~contrast) +
  labs(fill = "Sim. Data", y = "Change in Estimate SE", x = "Parameter") +
  theme_bw(base_size = 15) + theme(legend.position = c(0.88, 0.7), legend.background = element_rect(colour = 'black', fill = 'white', linetype='solid', size = .5), legend.key.size = unit(.5, "cm"))
ggsave(here::here("analyses", "figs1", "errorD", "sims_SE-Est_change.png"), width = 6.5, height = 4)
## negative sign for y: positive values indicate increase in SE relative to original data estimates
# More intuitive without facet_wrap?

param_R2change <- param_change %>% 
  group_by(contrast) %>% 
  summarize(R2_dif = mean(R2_dif))

ggplot(data = param_R2change) + 
  geom_col(aes(x = contrast, y = -R2_dif, fill = contrast), col = "black", alpha = 0.9, show.legend = FALSE) +
  scale_fill_manual(values = c("#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  geom_hline(yintercept = 0, lty = 2) +
  labs(y = bquote("Adj."~R^2~ "Change"), x = "Simulated Data") +
  theme_bw(base_size = 15)
ggsave(here::here("analyses", "figs1", "errorD", "sims_AdjR2_change.png"), width = 6, height = 4)


```

Negative values indicate the coefficient of the original data is LESS than the coefficient of the simulated data. More intuitive-- have subtraction go the other way.


#### Comparing Variance metrics among data sets
For the change in elevation, MAT/MAP norms and anomalies

**Create a Mega-data frame with all simulations in one table**:  
```{r warning = FALSE, results = 'hide'}
nemo_combinedsims1 <- bind_rows("OG" = nemo_e2, "2km" = sims_2kma, "5km" = sims_5kma, "15km" = sims_15kma, "25km" = sims_25kma, .id = "data_origin")

#Be mindful of the 5 replicates for each record of each simulated dataset

nemo_combinedsims2 <- nemo_combinedsims1 %>% 
  select(data_origin:DOY, replicate, MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_change:MAP_A_change, -c(date_new:day)) %>% #Select only variables to be analyzed
  mutate(replicate = case_when(data_origin != "OG" ~ replicate,
                               data_origin == "OG" ~ "rep1")) %>% # Append dummy replicate to OG data
  filter(replicate == "rep1") %>% #Filter just to rep1 
  mutate(data_origin = factor(data_origin, ordered = TRUE, levels = c("OG", "2km", "5km", "15km", "25km"))) #level order
```


**Compare Variance/SD among simulation groups**:  
```{r warning = FALSE, eval = FALSE}
#There doesn't seem to be any more robust ways to test for differences in variances bw groups than an F-test or Levene's test..

leveneTest(elev_m ~ data_origin, data = filter(nemo_combinedsims2, data_origin %in% c("OG", "25km")))

```



Compare variance (SD) estimates of predictor variables among original and simulated data sets.  

**EDA**
```{r message = FALSE, warning = FALSE}
#Note: The scales of SD among parameters greatly differ... comparisons among variables will not be reliable, but comparisons within variables will be

#Table for combining change values
enviro_change <- tibble(.rows = 20, contrast = rep(factor(c("2 km", "5 km", "15 km", "25 km"), levels = c("2 km", "5 km", "15 km", "25 km"), ordered = TRUE), 5), param = c(rep("elev", 4), rep("MAT_100Y", 4), rep("MAP_100Y", 4), rep("MAT_A", 4), rep("MAP_A", 4)), var_sd = NA, change_var_sd = NA)


#Variance
#lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_5kma %>% filter(replicate #== "rep1") %>% select(elev_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change)), #(sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change))), FUN = var)

##Variance in change variables increases with farther simulated distances

#SD
enviro_change$var_sd[1:4] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_m)), (sims_5kma %>% filter(replicate == "rep1") %>% select(elev_m)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_m)), (sims_25kma %>% filter(replicate == "rep1") %>% select(elev_m))), FUN = sd))

#Not used here
coeff_var <- function(x){
  X = as.numeric(x)
  cv = 100*(sd(X)/mean(X))
  cv}
#lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change))), FUN = coeff_var) #coefficient of variation
#coeff_var gives weird estimates that don't follow the trend of variance or sd...


#Other Variables

#MAT_100Y SD
enviro_change$var_sd[5:8] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_100Y)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_100Y)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_100Y)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_100Y))), FUN = sd))

#MAP_100Y SD
enviro_change$var_sd[9:12] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAP_100Y)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAP_100Y)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAP_100Y)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAP_100Y))), FUN = sd))

#MAT_A SD
enviro_change$var_sd[13:16] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_A)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_A)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_A)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_A))), FUN = sd))

#MAP_A SD
enviro_change$var_sd[17:20] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAP_A)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAP_A)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAP_A)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAP_A))), FUN = sd))




##
# SD of change varaibles (rel. to original data)
##

#Elev_m SD (Change)
enviro_change$change_var_sd[1:4] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change))), FUN = sd))

#MAT_100Y SD
enviro_change$change_var_sd[5:8] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_100Y_change))), FUN = sd))

#MAP_100Y SD
enviro_change$change_var_sd[9:12] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAP_100Y_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAP_100Y_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAP_100Y_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAP_100Y_change))), FUN = sd))

#MAT_A SD
enviro_change$change_var_sd[13:16] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_A_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_A_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_A_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_A_change))), FUN = sd))

#MAP_A SD
enviro_change$change_var_sd[17:20] <- as.numeric(lapply(X = c((sims_2kma %>% filter(replicate == "rep1") %>% select(MAP_A_change)), (sims_5kma %>% filter(replicate == "rep1") %>% select(MAP_A_change)), (sims_15kma %>% filter(replicate == "rep1") %>% select(MAP_A_change)), (sims_25kma %>% filter(replicate == "rep1") %>% select(MAP_A_change))), FUN = sd))



```


```{r message = FALSE, warning = FALSE, eval = FALSE}
#Visualizations
## --See more below

#Change variables
ggplot(data = enviro_change %>% filter(param == "elev")) +
  geom_col(aes(x = contrast, y = change_var_sd))
ggplot(data = enviro_change %>% filter(param == "MAT_100Y")) +
  geom_col(aes(x = contrast, y = change_var_sd))
ggplot(data = enviro_change %>% filter(param == "MAP_100Y")) + #Negligible change in MAP_100Y sd
  geom_col(aes(x = contrast, y = change_var_sd))
ggplot(data = enviro_change %>% filter(param == "MAT_A")) +
  geom_col(aes(x = contrast, y = change_var_sd))
ggplot(data = enviro_change %>% filter(param == "MAP_A")) +
  geom_col(aes(x = contrast, y = change_var_sd))
```
Combine tables--compare with original data 

```{r message = FALSE, warning = FALSE}
#With OG (error =< 2km) data
nemo_e2_c <- nemo_e2 %>% 
  mutate(elev_m_c = scale(elev_m, scale = FALSE),
         MAT_100Y_c = scale(MAT_100Y, scale = FALSE),
         MAP_100Y_c = scale(MAP_100Y, scale = FALSE)#, 
         #MAT_A_c = scale(MAT_A, scale = FALSE), #Anomalies already 0-centered
         #MAP_A_c = scale(MAP_A, scale = FALSE)
         )
lapply((nemo_e2_c %>% select(elev_m_c, MAT_100Y_c, MAP_100Y_c, MAT_A, MAP_A)), FUN = hist)


#as.numeric(lapply(X = c((nemo_e2_c %>% select(elev_m_c, MAT_100Y_c, MAP_100Y_c, MAT_A, MAP_A))), FUN = sd))

OGsds <- tibble(.rows = 5) %>% 
  mutate(contrast = rep("OG", 5), param = c("elev", "MAT_100Y", "MAP_100Y", "MAT_A", "MAP_A"), var_sd =         
  as.numeric(lapply(X = c((nemo_e2_c %>% select(elev_m, MAT_100Y, MAP_100Y, MAT_A, MAP_A))), FUN = sd)), change_var_sd = NA)
#Centered vs non-centered variables: no difference in estimates of variability. Stick w/ non-centered estimates.

#combine data frames
enviro_change2 = rbind(enviro_change, OGsds) %>% 
  mutate(contrast = factor(contrast, levels = c("OG", "2 km", "5 km", "15 km", "25 km"), ordered = TRUE))

#Visualize differences in variable SD among data sets
#Edit these
ggplot(data = filter(enviro_change2, param == "elev")) +
  geom_col(aes(x = contrast, y = var_sd, fill = contrast), col = "black", alpha = 0.9) +
  scale_fill_manual(values = c("#781C81", "#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  coord_cartesian(ylim = c(400, 500)) +
  labs(title = "Elevation", y = "Standard Deviation", x = "Data") +
  theme_bw()

ggplot(data = filter(enviro_change2, param == "MAT_100Y")) +
  geom_col(aes(x = contrast, y = var_sd, fill = contrast), col = "black", alpha = 0.9) +
  scale_fill_manual(values = c("#781C81", "#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  labs(title = "MAT (100Y)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggsave(here::here("analyses", "figs1", "errorD", "sims_SD_MAT_100Y.png"), width = 6, height = 4)

ggplot(data = filter(enviro_change2, param == "MAP_100Y")) +
  geom_col(aes(x = contrast, y = var_sd, fill = contrast), col = "black", alpha = 0.9) +
  scale_fill_manual(values = c("#781C81", "#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  labs(title = "MAP (100Y)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggsave(here::here("analyses", "figs1", "errorD", "sims_SD_MAP_100Y.png"), width = 6, height = 4)

ggplot(data = filter(enviro_change2, param == "MAT_A")) +
  geom_col(aes(x = contrast, y = var_sd, fill = contrast), col = "black", alpha = 0.9) +
  scale_fill_manual(values = c("#781C81", "#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  labs(title = "MAT (Anom.)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggsave(here::here("analyses", "figs1", "errorD", "sims_SD_MAT_A.png"), width = 6, height = 4)

ggplot(data = filter(enviro_change2, param == "MAP_A")) +
  geom_col(aes(x = contrast, y = var_sd, fill = contrast), col = "black", alpha = 0.9) +
  scale_fill_manual(values = c("#781C81", "#447CBF", "#83BA6D", "#DBAB3B", "#D92120")) +
  labs(title = "MAP (Anom.)", y = "Standard Deviation", x = "Data") +
  theme_bw()
ggsave(here::here("analyses", "figs1", "errorD", "sims_SD_MAP_A.png"), width = 6, height = 4)

```

Variance and SD increase with increasing simulated distances ONLY for MAT_A and MAP_A!!! There was little change in elevation SD and no discernible direction of change. Variable SD appeared to *decrease* for MAT_100Y and MAP_100Y, surprisingly. Why? Possibly because there is little variation in long-term average estimates of MAT/MAP? And data sets with farther displacements have marginally smaller sample sizes?


<br>  

#### Compare Frequency distributions
*Plot overlapping histograms for sd/variance in OG vs simulated ata parameters*

```{r eval = FALSE}
#Individual histograms
#OG data (centered)
lapply((nemo_e2_c %>% select(elev_m, MAT_100Y, MAP_100Y, MAT_A, MAP_A)), FUN = hist)

#Histograms for change in each of the 5 above variables - all centered around 0, as expected
lapply((sims_2kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #2km sims
lapply((sims_5kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #5km sims
lapply((sims_15kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #15km sims
lapply((sims_25kma %>% filter(replicate == "rep1") %>% select(elev_change:MAP_A_change)), FUN = hist) #25km sims

```


```{r}
#Elevation dsitrbution
ggplot(data = nemo_combinedsims2) +
  geom_histogram(aes(x = elev_m, fill = data_origin)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic() 


ggplot(data = nemo_combinedsims2) +
  geom_density(aes(x = elev_change, fill = data_origin)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic()

#Not very helpful for visualizing differences in variance... stick with bar plots above?


##OG vs 5 km simulations
ggplot(data = filter(nemo_combinedsims2)) +
  geom_density(aes(x = MAT_100Y, fill = data_origin), alpha = 0.6) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic()




## vs 15 km simulations



## vs 25 km simulations



```

<br>  


### Correlation among change variables and climate predictors
```{r}
library(corrplot)
corrplot(cor(sims_2kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)
#similar results for different replicates...

#5k
corrplot(cor(sims_5kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)

#15k
corrplot(cor(sims_15kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)

#25k
corrplot(cor(sims_25kma %>% filter(replicate == "rep1") %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, lat, long, year, elev_change, MAT_100Y_change, MAP_100Y_change, MAT_A_change, MAP_A_change)), method = "color", addCoef.col = "black", number.cex = .6)

```

**2km sims:**
Strongly correlated (r >= .65): MAT & MAP_100Y_change & elev_change 

Moderately correlated (0.3 < r < 0.65): MAT_A_change & MAP_A_change; MAT_A & MAT_A_change; MAT/MAP_A_change & elev_change (MAP_A_change & MAP_A r > 0.3 in some replicates)

**Larger sims:**  
Correlations b/w MAT/MAP_100Y & elev_change still strong, but become weaker. Correlation b/w MAT/MAP_A_change & MAT/MAP_A become **much stronger** (over 0.9 for MAT_A), corr w/ elev_change becomes **stronger** (r = .41 to .57)
Anomaly correlations w/ geography (lat, long, elev_m) also become stronger!
Increasing correlation b/w elev_m & elev_change


Conclusion: *Do not include `elev_change` and `MAT/MAP_100Y_change` in the same model!* when trying to interpret their effects. It seems reasonable here to assume that changes in elevation serve as a decent proxy for changes in long-term, chronic climatic conditions.
Correlations among `elev_change` and `MAT/MAP_A_change` are also present but more moderate, stronger w/ larger sim distances. Given strong correlations w/ `MAT/MAP_A`, examine predictive power of change variables alone. Check VIFs for all models.  

<br>  

**Correlations among change variables, change in coeff_estimates/SE by contrast**  
```{r}
sims_change <- merge(param_change, enviro_change2, by = c("contrast", "param"))
#Add elevation coeff values to 'param_change' table above?

corrplot(cor(sims_change %>% select(coef_dif, SE_dif, R2_dif, var_sd)), method = "color", addCoef.col = "black", number.cex = .6)

```
Change in R2 values is strongly negatively correlated with changes in coefficient SE! Also, changes in variable standard deviation (with increasing simulation distances) is positively correlated with coefficient differences.

*Double check that nothing funky is happening with these correlations...*

<br>  


## Influence of changes in variables on models with simulated data  
These models will be identical to those evaluated earlier in this Rmd, except now we include:
- elev_change
- MAT_A_change
- MAP_A_change

Examine differences in MAT_A and MAP_A coefficients, which in earlier comparisons became 0 or flipped to positive with greater dispersion distances. Use interaction b/w change variables and climatic predictors.
[Change variables alone as predictors -- removed. Mostly NS. No reasonable predictions for this]


As an additive predictor (no interaction), change in elevation was significant. Change in MAT/P_A explained variation in DOY less often. Quantitatively, these variables are probably associated with trends in actual local climate. Alone, these change variables have no reason to explain change in DOY. Therefore their interactive effects deserve more attention.

```{r eval = FALSE}
lmsim_change_1a <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A*elev_change + MAP_A*elev_change + lat + long, data = filter(sims_25kma, replicate == "rep1"))
summ(lmsim_change_1a, scale = TRUE, vif = TRUE)

#Other modls tested, no significant interactions found

```

No significant interaction between change variables and climatic predictors.

There may not be significant interactions of change variables with MAT_A or MAP_A, even if it accounts for change in estimates of sensitivity, since the magnitude of change depends on the simulated distance, which are separated in the different data sets. By accounting for this in a model:

```{r}
lmsim_change_c_1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A*elev_change + MAP_A*elev_change + lat + long + data_origin, data = filter(nemo_combinedsims2, replicate == "rep1")) #controls for data_origin
summ(lmsim_change_c_1, scale = TRUE, vif = TRUE)
#NS

lmsim_change_c_1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A*MAT_100Y_change + MAP_A*MAT_100Y_change + lat + long + data_origin, data = filter(nemo_combinedsims2, replicate == "rep1")) #controls for data_origin
summ(lmsim_change_c_1, scale = TRUE, vif = TRUE)
#NS

lmsim_change_c_1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A*MAT_A_change + MAP_A*MAT_A_change + lat + long + data_origin, data = filter(nemo_combinedsims2, replicate == "rep1")) #controls for data_origin
summ(lmsim_change_c_1, scale = TRUE, vif = TRUE)
#NS

```

<br>  


#### Averages among replicates  

**NOTE**: Averaging raw variables is NOT A GOOD IDEA for showing effect on anomalies. Averaged values for Anomalies will be inaccurate - lots of variations among replicates (even in 2 km sims) in anomalous conditions. In addition, averaged simulated coordinates may not accurately reflect deviations from the original point...    


Work around (below): average coefficient estimates, SEs, SD estimates for predictor variables for all replicates from a full data table...  

**Model averages** in table form

```{r}
#Build Table
param_table <- tibble(replicate = c(rep("rep1", 20), rep("rep2", 20), rep("rep3", 20), rep("rep4", 20), rep("rep5", 20))) %>% 
  mutate(contrast = rep(c(rep("2 km", 5), rep( "5 km", 5), rep("15 km", 5), rep("25 km", 5)), 5), param = rep(c("MAT_100Y", "MAP_100Y", "MAT_A", "MAP_A", "elev_m"), 20), coeff_est = NA, coeff_SE = NA, adj.R2 = NA, low.coeff.ci = NA, high.coeff.ci = NA) %>% 
mutate(contrast = factor(contrast, levels = c("2 km", "5 km", "15 km", "25 km"), ordered = TRUE))


#Fill coefficient estimates and SEs -- standardized
param_table$coeff_est[1:5] <- summ(MLA_2klmR1c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[1:5] <- summ(MLA_2klmR1c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[1:5] <- adjrsq(MLA_2klmR1c)
param_table$low.coeff.ci[1:5] <- summ(MLA_2klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[1:5] <- summ(MLA_2klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[6:10] <- summ(MLA_5klmR1c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[6:10] <- summ(MLA_5klmR1c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[6:10] <- adjrsq(MLA_5klmR1c)
param_table$low.coeff.ci[6:10] <- summ(MLA_5klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[6:10] <- summ(MLA_5klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[11:15] <- summ(MLA_15klmR1c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[11:15] <- summ(MLA_15klmR1c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[11:15] <- adjrsq(MLA_15klmR1c)
param_table$low.coeff.ci[11:15] <- summ(MLA_15klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[11:15] <- summ(MLA_15klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[16:20] <- summ(MLA_25klmR1c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[16:20] <- summ(MLA_25klmR1c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[16:20] <- adjrsq(MLA_25klmR1c)
param_table$low.coeff.ci[16:20] <- summ(MLA_25klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[16:20] <- summ(MLA_25klmR1c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

#Rep2
param_table$coeff_est[21:25] <- summ(MLA_2klmR2c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[21:25] <- summ(MLA_2klmR2c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[21:25] <- adjrsq(MLA_2klmR2c)
param_table$low.coeff.ci[21:25] <- summ(MLA_2klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[21:25] <- summ(MLA_2klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[26:30] <- summ(MLA_5klmR2c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[26:30] <- summ(MLA_5klmR2c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[26:30] <- adjrsq(MLA_5klmR2c)
param_table$low.coeff.ci[26:30] <- summ(MLA_5klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[26:30] <- summ(MLA_5klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[31:35] <- summ(MLA_15klmR2c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[31:35] <- summ(MLA_15klmR2c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[31:35] <- adjrsq(MLA_15klmR2c)
param_table$low.coeff.ci[31:35] <- summ(MLA_15klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[31:35] <- summ(MLA_15klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[36:40] <- summ(MLA_25klmR2c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[36:40] <- summ(MLA_25klmR2c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[36:40] <- adjrsq(MLA_25klmR2c)
param_table$low.coeff.ci[36:40] <- summ(MLA_25klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[36:40] <- summ(MLA_25klmR2c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

#Rep3
param_table$coeff_est[41:45] <- summ(MLA_2klmR3c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[41:45] <- summ(MLA_2klmR3c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[41:45] <- adjrsq(MLA_2klmR3c)
param_table$low.coeff.ci[41:45] <- summ(MLA_2klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[41:45] <- summ(MLA_2klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[46:50] <- summ(MLA_5klmR3c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[46:50] <- summ(MLA_5klmR3c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[46:50] <- adjrsq(MLA_5klmR3c)
param_table$low.coeff.ci[46:50] <- summ(MLA_5klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[46:50] <- summ(MLA_5klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[51:55] <- summ(MLA_15klmR3c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[51:55] <- summ(MLA_15klmR3c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[51:55] <- adjrsq(MLA_15klmR3c)
param_table$low.coeff.ci[51:55] <- summ(MLA_15klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[51:55] <- summ(MLA_15klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[56:60] <- summ(MLA_25klmR3c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[56:60] <- summ(MLA_25klmR3c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[56:60] <- adjrsq(MLA_25klmR3c)
param_table$low.coeff.ci[56:60] <- summ(MLA_25klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[56:60] <- summ(MLA_25klmR3c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

#Rep4
param_table$coeff_est[61:65] <- summ(MLA_2klmR4c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[61:65] <- summ(MLA_2klmR4c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[61:65] <- adjrsq(MLA_2klmR4c)
param_table$low.coeff.ci[61:65] <- summ(MLA_2klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[61:65] <- summ(MLA_2klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[66:70] <- summ(MLA_5klmR4c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[66:70] <- summ(MLA_5klmR4c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[66:70] <- adjrsq(MLA_5klmR4c)
param_table$low.coeff.ci[66:70] <- summ(MLA_5klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[66:70] <- summ(MLA_5klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[71:75] <- summ(MLA_15klmR4c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[71:75] <- summ(MLA_15klmR4c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[71:75] <- adjrsq(MLA_15klmR4c)
param_table$low.coeff.ci[71:75] <- summ(MLA_15klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[71:75] <- summ(MLA_15klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[76:80] <- summ(MLA_25klmR4c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[76:80] <- summ(MLA_25klmR4c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[76:80] <- adjrsq(MLA_25klmR4c)
param_table$low.coeff.ci[76:80] <- summ(MLA_25klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[76:80] <- summ(MLA_25klmR4c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

#Rep5
param_table$coeff_est[81:85] <- summ(MLA_2klmR5c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[81:85] <- summ(MLA_2klmR5c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[81:85] <- adjrsq(MLA_2klmR5c)
param_table$low.coeff.ci[81:85] <- summ(MLA_2klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[81:85] <- summ(MLA_2klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[86:90] <- summ(MLA_5klmR5c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[86:90] <- summ(MLA_5klmR5c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[86:90] <- adjrsq(MLA_5klmR5c)
param_table$low.coeff.ci[86:90] <- summ(MLA_5klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[86:90] <- summ(MLA_5klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[91:95] <- summ(MLA_15klmR5c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[91:95] <- summ(MLA_15klmR5c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[91:95] <- adjrsq(MLA_15klmR5c)
param_table$low.coeff.ci[91:95] <- summ(MLA_15klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[91:95] <- summ(MLA_15klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]

param_table$coeff_est[96:100] <- summ(MLA_25klmR5c, scale = TRUE)$coeftable[2:6,1]
param_table$coeff_SE[96:100] <- summ(MLA_25klmR5c, scale = TRUE)$coeftable[2:6,2]
param_table$adj.R2[96:100] <- adjrsq(MLA_25klmR5c)
param_table$low.coeff.ci[96:100] <- summ(MLA_25klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,2]
param_table$high.coeff.ci[96:100] <- summ(MLA_25klmR5c, scale = TRUE, confint = TRUE)$coeftable[2:6,3]




#Calculate CIs by hand:
#param_table <- param_table %>% 
#  mutate(low.coeff.ci = (coeff_est-(1.96*coeff_SE)),
#         high.coeff.ci = (coeff_est+(1.96*coeff_SE)))


##Summary table -- averages among replicates!!

param_sum_table <- param_table %>% 
  group_by(contrast, param) %>% 
  summarize(
  coeff_est_avg = mean(coeff_est),
  coeff_SE_avg = mean(coeff_SE),
  low_ci_avg = mean(low.coeff.ci),
  high_ci_avg = mean(high.coeff.ci))
  

ggplot(data = filter(param_sum_table, param != "elev_m")) + #exclude elev_m
  geom_errorbarh(aes(y = param, xmin = coeff_est_avg-coeff_SE_avg, xmax = coeff_est_avg+coeff_SE_avg, color = contrast), size = 1) +
  geom_point(aes(x = coeff_est_avg, y = param), size = 2) + 
  geom_vline(xintercept = 0, lty = 2) +
  facet_wrap(~contrast, ncol = 1) +
  labs(color = "Model Data", x = "Mean Estimate (standardized)") +
  theme_bw()
#These error bars are SEs, not 95% confidence intervals as in other plots; are not as broad
ggsave(here::here("analyses", "figs1", "errorD", "coeff_avg_across_reps_SEbars.png"), width = 6, height = 4)


#With manually calculated CIs
ggplot(data = filter(param_sum_table, param != "elev_m")) + #exclude elev_m
  geom_errorbarh(aes(y = param, xmin = low_ci_avg, xmax = high_ci_avg, color = contrast), size = 1) +
  geom_point(aes(x = coeff_est_avg, y = param), size = 2) + 
  geom_vline(xintercept = 0, lty = 2) +
  facet_wrap(~contrast, ncol = 1) +
  labs(color = "Model Data", x = "Mean Estimate (standardized)") +
  theme_bw()
ggsave(here::here("analyses", "figs1", "errorD", "coeff_avg_across_reps_CIbars.png"), width = 6, height = 4)


#With these averages, it appears that deviations beyond 5 km (as opposed to 15 km) lead to erroneous predictions wrt climate anomalies! BUT:  95% CIs would like be broader than these.

```
