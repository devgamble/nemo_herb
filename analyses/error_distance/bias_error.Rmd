---
title: "Bias in Herbarium data: Error Distance Analyses"
author: "Devin Gamble"
date: "7/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Load Packages
library(car)
library(tidyverse)
library(here)
library(ggplot2)
library(corrplot)
library(visreg)
library(jtools)
library(interactions)
```


Examining the effect of error distance (and other potential biases) in herbarium data  

Objective: Determine how records' error distance and other collection information might bias pheno-climatic models in *N. menziesii*  
Note: Several code chunks copied over from `EDA2.Rmd` and refined.    

**Main Results** Lines 220ish to 390ish.

*TO DO*  
- Decide on final models to report  
- Re-do Analyses (long-term climate) w/ 1961-1990 Data; supposedly the most fine-grained? Also pre-climate change...

<br>  

```{r message = FALSE, warning = FALSE, echo = FALSE}
#Load Data 

nemo_df2 <- read_csv(here::here("data_cleaning", "nemo_full_1901_2019.csv")) %>%  
  mutate(error_bin = as_factor(error_bin)) #Should this be ordered? #Combined specimen & climate data from 1901-2019
#1677 obs, 1251 columns

nemo_df1 <- read_csv(here::here("data_cleaning", "nemo_full_1861_2019.csv")) #Combined data for all years
#1764 obs, 1251 columns


#Set contrasts to sums
options(contrasts = c("contr.sum", "contr.poly"))
```

Data subset by error distances/bins  
```{r message = FALSE, warning = FALSE}
nemo_all_errors <- nemo_df2 %>% 
  filter(!is.na(error_dist_m)) 
#1239 out of 1764 obs with error distance
#1166 after rm records before 1901

#0-5 km resolution
nemo_e0_5 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km" | error_bin == "2-5 km") 

#0-4 km
nemo_e0_4 <-  nemo_all_errors %>% 
  filter(error_dist_m >= 0 & error_dist_m <= 4000) #Do Not include error_bin in models

#0-2 km
nemo_e2 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km") 

```


# Effect of Error Distance on Pheno-climatic models  

Measure the effect of error distance on pheno-climatic models'
- Parameter estimates  
- $R^2$ values  
- Significance of and differences b/w climate variables in their effect on DOY  

For 100 year averages and Anomalies, focus on MAT and MAP (Tmin_sp, Tmin_wt, PPT_sp, PPT_wt analyzed below)  

*Note*: Rationale for using nemo_df2: Climate data only available from 1901 onward. Locality data and error distance *may* be more accurate for records collected after 1900 as well...  

<br>  

## Subsetting data by error bins  

Details: Construct four models, one for each set of the data corresponding to levels of uncertainty. Include Temperature and Precipitation in the same model for *either* annual OR seasonal conditions, not both in the same model. One set of models with and without non-climatic predictors (elevation, longitude, year...). Interactions among variables were tested (for 'All Records' models) but, for the most part, are not included due to a lack of significant effects.  
- **Scale** parameter estimates to make them directly comparable 


**Evaluate Differences**: Compare parameter estimates visually using 95% confidence intervals (Find another [parametric] test to compare estimates?). Compare $R^2$ values qualitatively.  


100-Y MAT & MAP
```{r 100-Y MAT and MAP, message = FALSE, warning = FALSE}
##
#MAT & MAP
##
M100Y_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_df2)

er_an0 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_all_errors)
er_an1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_e0_5)
er_an2 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_e2)

plot_summs(M100Y_lm1, er_an0, er_an1, er_an2, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 10))
#ggsave(here::here("analyses", "figs1", "errorD", "error_d_subset_MAT-MAP1.png"), width = 6, height = 4)
#scale = TRUE refits model to mean-center & standardize the predictors but not the response. Use 'center = TRUE' to only mean center variables

summary(M100Y_lm1)$r.squared # N = 1677
summary(er_an0)$r.squared # N = 1166
summary(er_an1)$r.squared # N = 1033
summary(er_an2)$r.squared # N = 743


##
#MAT & MAP + other covariates
## 
M100Y_lm2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_df2)

erc_an0 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_all_errors)
erc_an1 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_e0_5)
erc_an2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_e2)


#Just Climate
plot_summs(M100Y_lm2, erc_an0, erc_an1, erc_an2, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT" =  "MAT_100Y", "MAP" = "MAP_100Y"), legend.title = "Model Data", scale = TRUE) + theme_bw() + theme(legend.title = element_text("Model Data", size = 10), legend.text = element_text(size = 9))+ labs(y = "Predictor") + scale_x_continuous(limits = c(-10, 15))
ggsave(here::here("analyses", "figs1", "errorD", "error_summs_MATMAP_100Y.png"), width = 6, height = 4)

#Climate & Covariates
plot_summs(M100Y_lm2, erc_an0, erc_an1, erc_an2, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT" =  "MAT_100Y", "MAP" = "MAP_100Y", "Elevation" = "elev_m", "Longitude" = "long", "Year" = "year"), legend.title = "Model Data", scale = TRUE) + theme_bw() + theme(legend.title = element_text("Model Data", size = 10), legend.text = element_text(size = 9))+ labs(y = "Predictor") + scale_x_continuous(limits = c(-10, 15))


summary(M100Y_lm2)$r.squared
summary(erc_an0)$r.squared
summary(erc_an1)$r.squared
summary(erc_an2)$r.squared

summ(M100Y_lm2, vif = TRUE)
#Ensure VIF values are < 4
```

```{r Diagnostics!, message = FALSE, warning = FALSE, echo = FALSE, eval = FALSE}
## DIAGNOSTICS ##
#V. large sample size may make some tests unreliable - graphical methods more appropriate

#Annual climate model
#M100Y_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_df2)
plot(M100Y_lm2)

summ(M100Y_lm1, vifs = TRUE)
vif(M100Y_lm1)
shapiro.test(M100Y_lm1$residuals) #graphs suggest model meets assumption, significant (non-normal) results may be a factor of sample size
durbinWatsonTest(M100Y_lm1) #Address with more covariates or more complex models to improve fit
durbinWatsonTest(M100Y_lm2AL) #slightly better but still S.
```
<br>  


MAT and MAP Anomalies   
```{r MAT and MAP Anomalies, message = FALSE, warning = FALSE, eval = FALSE}

M100Y_lm1A <- lm(DOY ~ MAT_A + MAP_A, data = nemo_df2)

er_an0A <- lm(DOY ~ MAT_A + MAP_A, data = nemo_all_errors)
er_an1A <- lm(DOY ~ MAT_A + MAP_A, data = nemo_e0_5)
er_an2A <- lm(DOY ~ MAT_A + MAP_A, data = nemo_e2)

plot_summs(M100Y_lm1A, er_an0A, er_an1A, er_an2A, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-10, 5))
#ggsave(here::here("analyses", "figs1", "errorD", "error_d_subset_MAT-MAP1A.png"), width = 6, height = 4)
#scale = TRUE refits model to mean-center & standardize the predictors but not the response. Use 'center = TRUE' to only mean center variables
summary(M100Y_lm1A)$r.squared # N = 1677
summary(er_an0A)$r.squared # N = 1166
summary(er_an1A)$r.squared # N = 1033
summary(er_an2A)$r.squared # N = 743


#Including other covariates
M100Y_lm2A <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = nemo_df2)

erc_an0A <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = nemo_all_errors)
erc_an1A <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = nemo_e0_5)
erc_an2A <- lm(DOY ~ MAT_A + MAP_A + elev_m + long + year, data = nemo_e2)

#Just Climate
plot_summs(M100Y_lm2A, erc_an0A, erc_an1A, erc_an2A, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_A" =  "MAT_A", "MAP_A" = "MAP_A"), legend.title = "Model Data", scale = TRUE) + theme_bw() + theme(legend.title = element_text("Model Data", size = 10), legend.text = element_text(size = 9)) + labs(y = "Predictor") + scale_x_continuous(limits = c(-10, 5))
ggsave(here::here("analyses", "figs1", "errorD", "error_summs_MATMAP_A.png"), width = 6, height = 4)

#Climate + Covariates
plot_summs(M100Y_lm2A, erc_an0A, erc_an1A, erc_an2A, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_A" =  "MAT_A", "MAP_A" = "MAP_A", "Elevation" = "elev_m", "Longitude" = "long", "Year" = "year"), legend.title = "Model Data", scale = TRUE) + theme_bw() + theme(legend.title = element_text("Model Data", size = 10), legend.text = element_text(size = 9)) + labs(y = "Predictor") + scale_x_continuous(limits = c(-10, 20))


summary(M100Y_lm2A)$r.squared
summary(erc_an0A)$r.squared
summary(erc_an1A)$r.squared
summary(erc_an2A)$r.squared

summ(M100Y_lm2A, vif = TRUE)
```

*Direction of the effect of longitude on DOY* **SWITCHES** *b/w long-term climate (positive) and climate anomalies (negative)... WTH? Its effect is normally negative when no climate predictors are included.*  

*UPDATE*: Same trend appears with latitude (lat), but VIF values in more complex models are much lower when using lat instead. However, effect of MAT_100Y becomes non-significant. Coefficient estimates and R2 values appear to change little.

<br>  

Anomalies & Long-term Climate

```{r Anomalies & Long-term Climate, message = FALSE, warning = FALSE}
#Base models, not geography/year covariates
M100Y_lm1AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_df2)

er_an0AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_all_errors)
er_an1AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_e0_5)
er_an2AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A, data = nemo_e2)

plot_summs(M100Y_lm1AL, er_an0AL, er_an1AL, er_an2AL, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))
ggsave(here::here("analyses", "figs1", "error_d_subset_MAT-MAP1AL.png"), width = 6, height = 4)

summary(M100Y_lm1AL)$r.squared # N = 1677
summary(er_an0AL)$r.squared # N = 1166
summary(er_an1AL)$r.squared # N = 1033
summary(er_an2AL)$r.squared # N = 743
```

```{r Anomalies & Long-term Climate v1.5, message = FALSE, warning = FALSE, eval = FALSE}
#Longitude instead of Latitude

#Including other covariates
M100Y_lm2AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = nemo_df2)

erc_an0AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = nemo_all_errors)
erc_an1AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = nemo_e0_5)
erc_an2AL <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + long + year, data = nemo_e2)

#Just Climate
plot_summs(M100Y_lm2AL, erc_an0AL, erc_an1AL, erc_an2AL, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))



#Climate & Covariates
plot_summs(M100Y_lm2AL, erc_an0AL, erc_an1AL, erc_an2AL, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A", "Elevation" = "elev_m", "Longitude" = "long", "Year" = "year"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))


summary(M100Y_lm2AL)$r.squared
summary(erc_an0AL)$r.squared
summary(erc_an1AL)$r.squared
summary(erc_an2AL)$r.squared

summ(M100Y_lm2AL, scale = TRUE, vif = TRUE)
```

```{r Anomalies & Long-term Climate v2, message = FALSE, warning = FALSE, eval = FALSE}
#Latitude instead of Longitude

M100Y_lm2ALa <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + year, data = nemo_df2)

erc_an0ALa <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + year, data = nemo_all_errors)
erc_an1ALa <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + year, data = nemo_e0_5)
erc_an2ALa <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + year, data = nemo_e2)

#Just Climate
plot_summs(M100Y_lm2ALa, erc_an0ALa, erc_an1ALa, erc_an2ALa, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))


#Climate & Covariates
plot_summs(M100Y_lm2ALa, erc_an0ALa, erc_an1ALa, erc_an2ALa, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A", "Elevation" = "elev_m", "Latitude" = "lat", "Year" = "year"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))


summary(M100Y_lm2ALa)$r.squared
summary(erc_an0ALa)$r.squared
summary(erc_an1ALa)$r.squared
summary(erc_an2ALa)$r.squared

summ(M100Y_lm2ALa, scale = TRUE, vif = TRUE)

lapply(list(M100Y_lm2ALa, erc_an0ALa ,erc_an1ALa, erc_an2ALa), summ, vif = TRUE, scale = TRUE)

```

*NOTE*: Effect of year becomes non-significant when anomalous conditions are in model. Makes sense.  


**Final Model** to report on:
```{r warning = FALSE}
#Latitude &&& Longitude
## This model used for reported results

M100Y_lm2ALb <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_df2)

erc_an0ALb <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_all_errors)
erc_an1ALb <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e0_5)
erc_an2ALb <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e2)

#Just Climate
plot_summs(M100Y_lm2ALb, erc_an0ALb, erc_an1ALb, erc_an2ALb, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT (100Y)" =  "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" =  "MAT_A", "MAP (Anom.)" = "MAP_A"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-8, 11)) + labs(y = "Predictor")
ggsave(here::here("analyses", "figs1", "errorD", "plotsumms_MATMAP_fullmodel1.png"), width = 6, height = 4)


#Climate & Covariates
plot_summs(M100Y_lm2ALb, erc_an0ALb, erc_an1ALb, erc_an2ALb, model.names = c("All records", "With error", "0-5 km", "0-2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A", "Elevation" = "elev_m", "Latitude" = "lat", "Longitude" = "long", "Year" = "year"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))

#More precise Adj. R2s
adjrsq <- function(x){
  rsq = getElement(summary.lm(x), "adj.r.squared")
  print(as.numeric(rsq))}
mod.list <- list(M100Y_lm2ALb, erc_an0ALb ,erc_an1ALb, erc_an2ALb)
sapply(mod.list, adjrsq)


summ(M100Y_lm2ALb, scale = TRUE, vif = TRUE)
#Full summary tables for all models
lapply(list(M100Y_lm2ALb, erc_an0ALb ,erc_an1ALb, erc_an2ALb), summ, vif = TRUE, scale = TRUE)

```

High VIFs for lat/long, as expected. But better R2 values. Coefficient estimates seem largely unaffected--very similar to long-long model (except for lat/long). VIF for elevation is slightly higher here than in long-only model. High multicollinearity among control variables, but not the climate variables of interest.

```{r Diagnostics, message = FALSE, warning = FALSE, echo = FALSE, eval = FALSE}
## DIAGNOSTICS ##
#V. large sample size may make some tests unreliable - graphical methods more appropriate

#Annual climate model
#M100Y_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_df2)
plot(M100Y_lm2ALb)

summ(M100Y_lm2ALb, vifs = TRUE)
vif(M100Y_lm2ALb)
shapiro.test(M100Y_lm2ALb$residuals) #graphs suggest model meets assumption, significant (non-normal) results may be a factor of sample size
durbinWatsonTest(M100Y_lm2ALb) #Address with more covariates or more complex models to improve fit
```

<br>  

**Correlation Matrix**  

For variables in model:

```{r Corr-plot, message = FALSE, warning = FALSE}
#png(filename = "corrplot_modelparams.png", units = "in", width = 5, height = 5, res = 300)

#Corrplot for supp mat?
corrplot(cor(nemo_df2 %>% select(MAT_100Y, MAP_100Y, MAT_A, MAP_A, elev_m, long, lat, year)), method = "color", addCoef.col = "black", number.cex = .6, outline = TRUE) #some autocorrelation in T anoms? elev*long corr
#similar VIFs as in 100Y only models, but these are still pretty low

#dev.off()

```

**Notes**: Lat & long are similarly correlated to 100Y MAT/MAP. Long is more correlated to elevation than Lat (0.51 vs -.41). This and the reduction in VIFs may be the only benefit of using lat over long. Additionally, MAT_100Y becomes *non-significant* when lat is used in the model instead of long.


<br>  


#### Visualizations  

```{r Partial-reg plots, warning = FALSE, message = FALSE, eval = FALSE}
#100Y MAT + MAP w/ covariates

#Latitude instead of longitude
#Report scaled coefficients

visreg(M100Y_lm2AL, "MAT_100Y", xlab = "MAT (1901-2000)", points = list(col = "#404040"), gg = TRUE) + 
  theme_apa()
ggsave(here::here("analyses", "figs1", "errorD", "DOY-MAT_100.png"), height = 4, width = 6) #Dims: 4x6 clearer than 5x8

visreg(M100Y_lm2AL, "MAP_100Y", xlab = "log[MAP] (1901-2000)", points = list(col = "#404040"), gg = TRUE) +  #option: use xtrans = exp 
  theme_apa()
ggsave(here::here("analyses", "figs1", "errorD", "DOY-MAP_100.png"), height = 4, width = 6)

visreg(M100Y_lm2AL, "MAT_A", xlab = "MAT (Anomaly)", points = list(col = "#404040"), gg = TRUE) + 
  geom_vline(xintercept = 0, lty = 2) +
  theme_apa()
ggsave(here::here("analyses", "figs1", "errorD", "DOY-MAT_A.png"), height = 4, width = 6)

visreg(M100Y_lm2AL, "MAP_A", xlab = "MAP (Anomaly)", points = list(col = "#404040"), gg = TRUE) + 
  geom_vline(xintercept = 0, lty = 2) +
  theme_apa()
ggsave(here::here("analyses", "figs1", "errorD", "DOY-MAP_A.png"), height = 4, width = 6)
#Alternative - use ggplot instead

```

<br>  



## Error Distance as a covariate   

*Note*: log-transformation of `error_dist_m` seems to improve normality, may be appropriate.  

### DOY as response  

`error_bin` level sizes:  
- <2 km = 743  
- 2-5 km = 290  
- 5-10 km = 91  
- 10-15 km = 24  
- >15 km = 18  
- NA = 511  

**Error Bin (Categorical)**  

```{r message = FALSE, warning = FALSE}
#plot(nemo_df2$error_bin)

clim_errorbin_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + error_bin, data = nemo_df2)

summ(clim_errorbin_lm1, scale = TRUE, vifs = TRUE)



#Include NA error distance bin values
nemo_ebins_df2 <- nemo_df2 %>% 
  mutate(error_bin2 = case_when(error_dist_m <= 2000 ~ "<2 km",
                               error_dist_m > 2000 & error_dist_m <= 5000 ~ "2-5 km",
                               error_dist_m > 5000 & error_dist_m <= 10000 ~ "5-10 km",
                               error_dist_m > 10000 & error_dist_m <= 15000 ~ "10-15 km", 
                               error_dist_m > 15000 ~ ">15 km",
                               is.na(error_dist_m) ~ "missing")) %>% 
  mutate(error_bin2 = factor(error_bin2, levels = c( "<2 km", "2-5 km", "5-10 km", "10-15 km", ">15 km", "missing")))


clim_errorbin_lm2 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + error_bin2, data = nemo_ebins_df2)

summ(clim_errorbin_lm2, scale = TRUE, vifs = TRUE)



#No intercept model - show all error levels means - not recommended
#clim_errorbin_lm3 <- lm(DOY ~ 0 + MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + error_bin, data = nemo_df2)

#summ(clim_errorbin_lm3, scale = TRUE, vifs = TRUE)

```


**Error Distance (Quantitative)**  

```{r}
hist(nemo_df2$error_dist_m)
hist(log(nemo_df2$error_dist_m))
#Does error distance need to be transformed? Maybe....

clim_errorm_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year + error_dist_m, data = nemo_df2)

summ(clim_errorm_lm1, scale = TRUE, vifs = TRUE)

```




### Seasonal Conditions  

These have not been updated due to the decision to include only MAT/MAP for error distance analyses.  

**Winter 100Y MAT/MAP**  

```{r message = FALSE, warning = FALSE}

#Without covariates
Wt100Y_lm1 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y, data = nemo_df2)

er_wt0 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y, data = nemo_all_errors)
er_wt1 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y, data = nemo_e0_5)
er_wt2 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y, data = nemo_e2)

plot_summs(Wt100Y_lm1, er_wt0, er_wt1, er_wt2, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1.png"), width = 6, height = 4)
summary(Wt100Y_lm1)
summary(er_wt0)$r.squared
summary(er_wt1)$r.squared
summary(er_wt2)$r.squared

#
#With Interactions (without other covariates)
Wt100Y_lm1i <- lm(DOY ~ Tmin_wt_100Y*PPT_wt_100Y, data = nemo_df2)

er_wt0i <- lm(DOY ~ Tmin_wt_100Y*PPT_wt_100Y, data = nemo_all_errors)
er_wt1i <- lm(DOY ~ Tmin_wt_100Y*PPT_wt_100Y, data = nemo_e0_5)
er_wt2i <- lm(DOY ~ Tmin_wt_100Y*PPT_wt_100Y, data = nemo_e2)

plot_summs(Wt100Y_lm1i, er_wt0i, er_wt1i, er_wt2i, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) +
  theme_bw()
ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1i.png"), width = 6, height = 4)
summary(Wt100Y_lm1i)
summary(er_wt0i)#$r.squared
summary(er_wt1i)#$r.squared
summary(er_wt2i)#$r.squared


#
#With Covariates
Wt100Y_lm2 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + elev_m + long + year, data = nemo_df2)

erc_wt0 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + elev_m + long + year, data = nemo_all_errors)
erc_wt1 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + elev_m + long + year, data = nemo_e0_5)
erc_wt2 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + elev_m + long + year, data = nemo_e2)

plot_summs(Wt100Y_lm2, erc_wt0, erc_wt1, erc_wt2, model.names = c("OG", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "error_d_subset_Wt2.png"), width = 6, height = 4)
summary(Wt100Y_lm2)
summary(erc_wt0)$r.squared
summary(erc_wt1)$r.squared
summary(erc_wt2)$r.squared
```
Including finer-scale error distances in 'wt' models with interactions increases the variance and, for 0-2 and 0-5 km, makes parameter estimates non-significant.  


**Winter MAT/MAP + Anomalies**    

```{r message = FALSE, warning = FALSE}
#Without covariates
Wt100Y_lm1AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A, data = nemo_df2)

er_wt0AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A, data = nemo_all_errors)
er_wt1AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A, data = nemo_e0_5)
er_wt2AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A, data = nemo_e2)

plot_summs(Wt100Y_lm1AL, er_wt0AL, er_wt1AL, er_wt2AL, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1AL.png"), width = 6, height = 4)
summary(Wt100Y_lm1AL)
summary(er_wt0AL)$r.squared
summary(er_wt1AL)$r.squared
summary(er_wt2AL)$r.squared

#
#With Interactions (without other covariates)
#NOTE: Interactions among Tmin and PPT anomalies very non-significant (p = .99)
Wt100Y_lm1iAL <- lm(DOY ~ Tmin_wt_A*PPT_wt_100Y + Tmin_wt_100Y*PPT_wt_A, data = nemo_df2)

er_wt0iAL <- lm(DOY ~ Tmin_wt_A*PPT_wt_100Y + Tmin_wt_100Y*PPT_wt_A, data = nemo_all_errors)
er_wt1iAL <- lm(DOY ~ Tmin_wt_A*PPT_wt_100Y + Tmin_wt_100Y*PPT_wt_A, data = nemo_e0_5)
er_wt2iAL <- lm(DOY ~ Tmin_wt_A*PPT_wt_100Y + Tmin_wt_100Y*PPT_wt_A, data = nemo_e2)

plot_summs(Wt100Y_lm1iAL, er_wt0iAL, er_wt1iAL, er_wt2iAL, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) +
  theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1ALi.png"), width = 6, height = 4)
summary(Wt100Y_lm1iAL)
summary(er_wt0iAL)#$r.squared
summary(er_wt1iAL)#$r.squared
summary(er_wt2iAL)#$r.squared

#
#Interactions V 2
Wt100Y_lm1iAL2 <- lm(DOY ~ Tmin_wt_A*Tmin_wt_100Y + PPT_wt_A*PPT_wt_100Y, data = nemo_df2)

er_wt0iAL2 <- lm(DOY ~ Tmin_wt_A*Tmin_wt_100Y + PPT_wt_A*PPT_wt_100Y, data = nemo_all_errors)
er_wt1iAL2 <- lm(DOY ~ Tmin_wt_A*Tmin_wt_100Y + PPT_wt_A*PPT_wt_100Y, data = nemo_e0_5)
er_wt2iAL2 <- lm(DOY ~ Tmin_wt_A*Tmin_wt_100Y + PPT_wt_A*PPT_wt_100Y, data = nemo_e2)

plot_summs(Wt100Y_lm1iAL2, er_wt0iAL2, er_wt1iAL2, er_wt2iAL2, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) +
  theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1ALi.png"), width = 6, height = 4)
summary(Wt100Y_lm1iAL2)
summary(er_wt0iAL2)#$r.squared
summary(er_wt1iAL2)#$r.squared
summary(er_wt2iAL2)#$r.squared


#
#With Covariates
Wt100Y_lm2AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A + elev_m + long + year, data = nemo_df2)

erc_wt0AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A + elev_m + long + year, data = nemo_all_errors)
erc_wt1AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A + elev_m + long + year, data = nemo_e0_5)
erc_wt2AL <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + Tmin_wt_A + PPT_wt_A + elev_m + long + year, data = nemo_e2)

plot_summs(Wt100Y_lm2AL, erc_wt0AL, erc_wt1AL, erc_wt2AL, model.names = c("OG", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Wt2AL.png"), width = 6, height = 4)
summary(Wt100Y_lm2AL)
summary(erc_wt0AL)$r.squared
summary(erc_wt1AL)$r.squared
summary(erc_wt2AL)$r.squared


```

Interactions disappear when accounting for anomalous climate. The effect of year is still significant here (including covs), unlike in MAT/MAP models above.  
<br>  


**Spring 100Y MAT/MAP**  

```{r message = FALSE, warning = FALSE}

#Without covariates
Sp100Y_lm1 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y, data = nemo_df2)

er_sp0 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y, data = nemo_all_errors)
er_sp1 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y, data = nemo_e0_5)
er_sp2 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y, data = nemo_e2)

plot_summs(Sp100Y_lm1, er_sp0, er_sp1, er_sp2, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "error_d_subset_Sp1.png"), width = 6, height = 4)
summary(Sp100Y_lm1)
summary(er_sp0)$r.squared
summary(er_sp1)$r.squared
summary(er_sp2)$r.squared

#
#With interactions (without other covariates)
Sp100Y_lm1i <- lm(DOY ~ Tmin_sp_100Y*PPT_sp_100Y, data = nemo_df2)

er_sp0i <- lm(DOY ~ Tmin_sp_100Y*PPT_sp_100Y, data = nemo_all_errors)
er_sp1i <- lm(DOY ~ Tmin_sp_100Y*PPT_sp_100Y, data = nemo_e0_5)
er_sp2i <- lm(DOY ~ Tmin_sp_100Y*PPT_sp_100Y, data = nemo_e2)

plot_summs(Sp100Y_lm1i, er_sp0i, er_sp1i, er_sp2i, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "error_d_subset_Sp1i.png"), width = 6, height = 4)
summary(Sp100Y_lm1i)
summary(er_sp0i)$r.squared
summary(er_sp1i)$r.squared
summary(er_sp2i)$r.squared


#
#With Covariates - interaction ns and removed
Sp100Y_lm2 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_df2)

erc_sp0 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_all_errors)
erc_sp1 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_e0_5)
erc_sp2 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_e2)

plot_summs(Sp100Y_lm2, erc_sp0, erc_sp1, erc_sp2, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "error_d_subset_Sp2.png"), width = 6, height = 4)
summary(Sp100Y_lm2)
summary(erc_sp0)#$r.squared
summary(erc_sp1)#$r.squared
summary(erc_sp2)#$r.squared

```
<br>  



**Spring MAT/MAP + Anomalies**  

```{r message = FALSE, warning = FALSE}

#Without covariates
Sp100Y_lm1AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A, data = nemo_df2)

er_sp0AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A, data = nemo_all_errors)
er_sp1AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A, data = nemo_e0_5)
er_sp2AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A, data = nemo_e2)

plot_summs(Sp100Y_lm1AL, er_sp0AL, er_sp1AL, er_sp2AL, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Sp1.png"), width = 6, height = 4)
summary(Sp100Y_lm1AL)
summary(er_sp0AL)$r.squared
summary(er_sp1AL)$r.squared
summary(er_sp2AL)$r.squared

#
#With interactions (without other covariates)
#NOTE: Interactions among Tmin and PPT anomalies very non-significant (p = .99)
Sp100Y_lm1iAL <- lm(DOY ~ Tmin_sp_A*PPT_sp_100Y + Tmin_sp_100Y*PPT_sp_A, data = nemo_df2)

er_sp0iAL <- lm(DOY ~ Tmin_sp_A*PPT_sp_100Y + Tmin_sp_100Y*PPT_sp_A, data = nemo_all_errors)
er_sp1iAL <- lm(DOY ~ Tmin_sp_A*PPT_sp_100Y + Tmin_sp_100Y*PPT_sp_A, data = nemo_e0_5)
er_sp2iAL <- lm(DOY ~ Tmin_sp_A*PPT_sp_100Y + Tmin_sp_100Y*PPT_sp_A, data = nemo_e2)

plot_summs(Sp100Y_lm1iAL, er_sp0iAL, er_sp1iAL, er_sp2iAL, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) +
  theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1ALi.png"), width = 6, height = 4)
summary(Sp100Y_lm1iAL)
summary(er_sp0iAL)#$r.squared
summary(er_sp1iAL)#$r.squared
summary(er_sp2iAL)#$r.squared

#
#Interactions V 2
Sp100Y_lm1iAL2 <- lm(DOY ~ Tmin_sp_A*Tmin_sp_100Y + PPT_sp_A*PPT_sp_100Y, data = nemo_df2)

er_sp0iAL2 <- lm(DOY ~ Tmin_sp_A*Tmin_sp_100Y + PPT_sp_A*PPT_sp_100Y, data = nemo_all_errors)
er_sp1iAL2 <- lm(DOY ~ Tmin_sp_A*Tmin_sp_100Y + PPT_sp_A*PPT_sp_100Y, data = nemo_e0_5)
er_sp2iAL2 <- lm(DOY ~ Tmin_sp_A*Tmin_sp_100Y + PPT_sp_A*PPT_sp_100Y, data = nemo_e2)

plot_summs(Sp100Y_lm1iAL2, er_sp0iAL2, er_sp1iAL2, er_sp2iAL2, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) +
  theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Wt1ALi.png"), width = 6, height = 4)
summary(Sp100Y_lm1iAL2)
summary(er_sp0iAL2)#$r.squared
summary(er_sp1iAL2)#$r.squared
summary(er_sp2iAL2)#$r.squared


#
#With Covariates - interaction ns and removed
Sp100Y_lm2AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A + elev_m + long + year, data = nemo_df2)

erc_sp0AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A + elev_m + long + year, data = nemo_all_errors)
erc_sp1AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + Tmin_sp_A + PPT_sp_A + elev_m + long + year, data = nemo_e0_5)
erc_sp2AL <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_e2)

plot_summs(Sp100Y_lm2AL, erc_sp0AL, erc_sp1AL, erc_sp2AL, model.names = c("All Records", "With error", "0-5 km", "0-2 km"), scale = TRUE) + theme_bw()
#ggsave(here::here("analyses", "figs1", "error_d_subset_Sp2.png"), width = 6, height = 4)
summary(Sp100Y_lm2AL)
summary(erc_sp0AL)#$r.squared
summary(erc_sp1AL)#$r.squared
summary(erc_sp2AL)#$r.squared

```


##### In Summary  


Filtering out larger error_bins led to no real improvements in model $R^2$s, though of the *subsets* the 0-5 group may have slightly better $R^2$s. Based on confidence intervals, there are no significant differences in parameter estimates between all observations and data including less uncertain coordinate estimates.  


Using data from more precise error distances led to **increases in parameter estimate variation (SE)**, especially for 0-2 km.  

Lack of improvements may be due to loss of meaningful variation from records with greater uncertainty. Also, looking only at records with any error distance, there is a reduction in $R^2$ values.

Using finer error distances may actually reduce variation and obscure meaningful variable interactions!!  


In future models consider comparing all data with those with *errors from 0-5 km*?   


<br>  



#### Checking M.E. discrete bins as specified in `nemo_df2` in their effect on coefficient estimates  
These suffer from small samples sizes above 10 km error distance:

```{r eval = FALSE}
#No error distance
nemo_no_errors <- nemo_df2 %>% 
  filter(is.na(error_dist_m)) 
#511 obs

#> 15 km error
nemo_e15 <- nemo_all_errors %>% 
  filter(error_bin == ">15 km") 
#18 obs

#10-15 km resolution
nemo_e10_15 <- nemo_all_errors %>% 
  filter(error_bin == "10-15 km") 
#24 obs

###ALT: 10 km+ error
nemo_e10plus <- nemo_all_errors %>% 
  filter(error_bin %in% c("10-15 km", ">15 km")) 
#42 obs

#5-10 km
nemo_e5_10 <- nemo_all_errors %>% 
  filter(error_bin == "5-10 km") 
#91 obs

#2-5 km
nemo_e2_5 <- nemo_all_errors %>% 
  filter(error_bin == "2-5 km") 
#290 obs

#0-2 km
nemo_e2 <- nemo_all_errors %>% 
  filter(error_bin == "<2 km") 
#743 obs

```

```{r eval = FALSE}
M100Y_lmALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_df2)

erc_an0ALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_no_errors)
erc_an1ALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e15)
erc_an2ALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e10_15)
erc_an3ALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e5_10)
erc_an4ALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e2_5)
erc_an5ALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e2)

#Alt: 10plus error as highest group
erc_an10pALd <- lm(DOY ~ MAT_100Y + MAP_100Y + MAT_A + MAP_A + elev_m + lat + long + year, data = nemo_e10plus)

#Just Climate
plot_summs(M100Y_lmALd, erc_an0ALd, erc_an1ALd, erc_an2ALd, erc_an3ALd, erc_an4ALd, erc_an5ALd, model.names = c("All records", "No error", ">15 km", "10-15 km", "5-10 km", "2-5 km", "<2 km"), coefs = c("MAT (100Y)" =  "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" =  "MAT_A", "MAP (Anom.)" = "MAP_A"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-8, 11)) + labs(y = "Predictor")
#ggsave(here::here("analyses", "figs1", "errorD", "plotsumms_MATMAP_fullmodel1.png"), width = 6, height = 4)


#Climate & Covariates
plot_summs(M100Y_lmALd, erc_an0ALd, erc_an1ALd, erc_an2ALd, erc_an3ALd, erc_an4ALd, erc_an5ALd, model.names = c("All records", "No error", ">15 km", "10-15 km", "5-10 km", "2-5 km", "<2 km"), coefs = c("MAT_100Y" =  "MAT_100Y", "MAP_100Y" = "MAP_100Y", "MAT_A" =  "MAT_A", "MAP_A" = "MAP_A", "Elevation" = "elev_m", "Latitude" = "lat", "Longitude" = "long", "Year" = "year"), scale = TRUE) + theme_bw() + scale_x_continuous(limits = c(-15, 15))

#More precise Adj. R2s
mod.list <- list(M100Y_lmALd, erc_an0ALd, erc_an1ALd, erc_an2ALd, erc_an3ALd, erc_an4ALd, erc_an5ALd)
sapply(mod.list, adjrsq)


#Full summary tables for all models
lapply(list(M100Y_lmALd, erc_an0ALd, erc_an1ALd, erc_an2ALd, erc_an3ALd, erc_an4ALd, erc_an5ALd), summ, vif = TRUE, scale = TRUE)


#These results are all over the place... would not make sense to use.

```


```{r eval = FALSE}
#W/ 10+ group
plot_summs(M100Y_lmALd, erc_an0ALd, erc_an10pALd, erc_an3ALd, erc_an4ALd, erc_an5ALd, model.names = c("All records", "No error", ">10 km", "5-10 km", "2-5 km", "<2 km"), coefs = c("MAT (100Y)" =  "MAT_100Y", "MAP (100Y)" = "MAP_100Y", "MAT (Anom.)" =  "MAT_A", "MAP (Anom.)" = "MAP_A"), scale = TRUE) + theme_bw() 
#+ scale_x_continuous(limits = c(-8, 11)) + labs(y = "Predictor") #removed -- hides 10+ results
#ggsave(here::here("analyses", "figs1", "errorD", "plotsumms_MATMAP_fullmodel1.png"), width = 6, height = 4)

lapply(list(M100Y_lmALd, erc_an0ALd, erc_an1ALd, erc_an2ALd, erc_an3ALd, erc_an4ALd, erc_an5ALd), summ, vif = TRUE, scale = TRUE)
```


### Other variables as a response - checking for error distance~geography/climate trends/biases  

*None of these appear to be significant or provide indication that there is bias or noise introduce by error distance*  

#### ANOVAs and Linear Regressions    


Are there differences in collected records lat/long, elevation, MAT/MAP (other climate) due to error distance (bins)?  

DOY
```{r warning = FALSE, message = FALSE}

edbin0 <- lm(DOY ~ error_bin, data = nemo_df2)
summary(edbin0)
anova(edbin0) #ns

visreg(edbin0)


```

Latitude & Longitude  
```{r warning = FALSE, message = FALSE}
library(car)
###Fix contrasts?
#
#Log-transformation attempted on regression models 

#Lat
#ANOVA
edbin1 <- lm(lat ~ error_bin, data = nemo_df2)
anova(edbin1)

#Regression
edbin1a <- lm(lat ~ error_dist_m, data = nemo_df2)
summary(edbin1a)


#Long
#ANOVA
edbin2 <- lm(long ~ error_bin, data = nemo_df2)
anova(edbin2)

#Regression
edbin2a <- lm(long ~ error_dist_m, data = nemo_df2)
summary(edbin2a)

```


Elevation
```{r warning = FALSE, message = FALSE}
#ANOVA
edbin3 <- lm(elev_m ~ error_bin, data = nemo_df2)
anova(edbin3)
summary(edbin3)
#Elevation not quite normally distributed - what to do? #Maybe a sqrt transformation? or glm? Or leave as is

#plots
plot(TukeyHSD(aov(edbin3)))

visreg(edbin3)
#ggplot(data = nemo_df2, aes(x = error_bin, y = elev_m)) +
#  geom_boxplot()



#Regression 
edbin3a <- lm(elev_m ~ log(error_dist_m), data = nemo_df2)
summary(edbin3a)
#marginally non-significant with log()

ggplot(data = nemo_df2, aes(x = log(error_dist_m), y = elev_m)) +
  geom_point() +
  geom_smooth(method = 'lm')
```


MAT
```{r warning = FALSE, message = FALSE}
#ANOVA
edbin4 <- lm(MAT_100Y ~ error_bin, data = nemo_df2)
anova(edbin4)
summary(edbin4)

plot(TukeyHSD(aov(edbin4)))
#Diff b/w 10.15-15 km and 10.15-5-10 km 
#Differences may not be significant from 0 in their effect ?

visreg(edbin4)

#No discernible trend


#Regression
edbin4a <- lm(MAT_100Y ~ error_dist_m, data = nemo_df2)
summary(edbin4a) #ns #log trnsfrm no effect
```

MAP
```{r warning = FALSE, message = FALSE}
#
#MAP 
edbin5 <- lm(MAP_100Y ~ error_bin, data = nemo_df2)
anova(edbin5)
summary(edbin5)

visreg(edbin5)

#Regression
edbin5a <- lm(MAP_100Y ~ error_dist_m, data = nemo_df2)
summary(edbin5a) #unusual - very significant

visreg(edbin5a)

edbin5b <- lm(MAP_100Y ~ log(error_dist_m), data = nemo_df2)
summary(edbin5b) #significance lost with log transformation - likely noise

visreg(edbin5b)

```


Any variation among error_bin levels appears to be due to chance/noise, as confidence intervals are very wide and there is no main (numeric) effect of error_dist_m on any of the above response variables.   

<br>  


----  


### Investigating manually georeferenced specimens  

*There is little 'EFFECT' to investigate: there are chance differences in the characteristics of specimens that we referenced that are exhibited below - there's no way to tell whether our georeferencing has any effect on DOY~Climate*  

#### Subsetting models  

```{r message = FALSE, warning = FALSE}
#USE pre 1901 records for this? or no...
#Records we georeferenced:
nemo_geor <- nemo_df2 %>% 
  filter(!is.na(georef_by)) #N = 438 obs

nemo_ngeo <- nemo_df2 %>% 
  filter(is.na(georef_by)) #records that we did not georeference (N = 1239)

```


MAT & MAP

```{r message = FALSE, warning = FALSE}
#Our georeferenced records relative to all records
#Just climate predictors
M100Y_lmg1 <- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_geor)
summary(M100Y_lmg1)

#Other predictors
M100Y_lmg2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_geor)
summary(M100Y_lmg2)


plot_summs(M100Y_lm1, M100Y_lmg1, model.names = c("All data", "GeoL"), scale = TRUE)

plot_summs(M100Y_lm2, M100Y_lmg2, model.names = c("All data", "GeoL"), scale = TRUE)

```

From these averages it's clear that subsetting by specimens we georeferenced increases variation in the parameter estimate, as did subsetting by smaller error distances above. In the model with climate-only predictors, our georeferenced specimens alone may be underestimating the effect of MAT_100Y on DOY...  


What about data we did not georeference?  

```{r warning = FALSE, message = FALSE}
M100Y_lmg3<- lm(DOY ~ MAT_100Y + MAP_100Y, data = nemo_ngeo)
M100Y_lmg4<- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_ngeo)
summary(M100Y_lmg3)
summary(M100Y_lmg4)

plot_summs(M100Y_lm1, M100Y_lmg1, M100Y_lmg3, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "geor_plotsumms_MAT-MAP1.png"), width = 6, height = 4)

plot_summs(M100Y_lm2, M100Y_lmg2, M100Y_lmg4, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "geor_plotsumms_MAT-MAP2.png"), width = 6, height = 4)
```


Winter Conditions  
```{r warning = FALSE, message = FALSE}
#Climate-only
Wt100Y_lmg1 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y, data = nemo_geor)
Wt100Y_lmg3<- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y, data = nemo_ngeo)

#Interactions
Wt100Y_lmg1i <- lm(DOY ~ Tmin_wt_100Y*PPT_wt_100Y, data = nemo_geor)
Wt100Y_lmg3i<- lm(DOY ~ Tmin_wt_100Y*PPT_wt_100Y, data = nemo_ngeo)


#Other predictors
Wt100Y_lmg2 <- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + elev_m + long + year, data = nemo_geor)
Wt100Y_lmg4<- lm(DOY ~ Tmin_wt_100Y + PPT_wt_100Y + elev_m + long + year, data = nemo_ngeo)


plot_summs(Wt100Y_lm1, Wt100Y_lmg1, Wt100Y_lmg3, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "geor_plotsumms_Wt1.png"), width = 6, height = 4)

plot_summs(Wt100Y_lm1i, Wt100Y_lmg1i, Wt100Y_lmg3i, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "geor_plotsumms_Wt1i.png"), width = 6, height = 4)

plot_summs(Wt100Y_lm2, Wt100Y_lmg2, Wt100Y_lmg4, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
#ggsave(here::here("analyses", "figs1", "geor_plotsumms_Wt2.png"), width = 6, height = 4)
```


```{r warning = FALSE, message = FALSE, eval = FALSE}
summary(Wt100Y_lmg1)
summary(Wt100Y_lmg3)
summary(Wt100Y_lmg1i)
summary(Wt100Y_lmg3i)
summary(Wt100Y_lmg2)
summary(Wt100Y_lmg4)

```

Spring Conditions
```{r warning = FALSE, message = FALSE}
#Climate-only
Sp100Y_lmg1 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y, data = nemo_geor)
Sp100Y_lmg3<- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y, data = nemo_ngeo)

#Interactions
Sp100Y_lmg1i <- lm(DOY ~ Tmin_sp_100Y*PPT_sp_100Y, data = nemo_geor)
Sp100Y_lmg3i<- lm(DOY ~ Tmin_sp_100Y*PPT_sp_100Y, data = nemo_ngeo)


#Other predictors
Sp100Y_lmg2 <- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_geor)
Sp100Y_lmg4<- lm(DOY ~ Tmin_sp_100Y + PPT_sp_100Y + elev_m + long + year, data = nemo_ngeo)


plot_summs(Sp100Y_lm1, Sp100Y_lmg1, Sp100Y_lmg3, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "geor_plotsumms_Sp1.png"), width = 6, height = 4)

plot_summs(Sp100Y_lm1i, Sp100Y_lmg1i, Sp100Y_lmg3i, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
ggsave(here::here("analyses", "figs1", "geor_plotsumms_Sp1i.png"), width = 6, height = 4)

plot_summs(Sp100Y_lm2, Sp100Y_lmg2, Sp100Y_lmg4, model.names = c("All data", "GeoL", "Herb"), scale = TRUE) + theme_bw()
#ggsave(here::here("analyses", "figs1", "geor_plotsumms_Wt1.png"), width = 6, height = 4)
```


```{r warning = FALSE, message = FALSE, eval = FALSE}
summary(Sp100Y_lmg1)
summary(Sp100Y_lmg3)
summary(Sp100Y_lmg1i)
summary(Sp100Y_lmg3i)
summary(Sp100Y_lmg2)
summary(Sp100Y_lmg4)

```

Ours still seem a little more variable (and NS in a couple cases), but are quite similar to herbarium-georeferenced data. Most likely due to a smaller sample size of records we georeferenced, though we may have been less accurate than others.  

Georef_by as a covariate  
```{r warning = FALSE, message = FALSE, echo = FALSE}

nemo_gby <- nemo_df2 %>% 
  mutate(geo_f = as_factor(case_when(!is.na(georef_by) ~ "y",
                           is.na(georef_by) ~ "n")))

M100Y_lmg3b <- lm(DOY ~ MAT_100Y + MAP_100Y + geo_f, data = nemo_gby)
M100Y_lmg4b <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year + geo_f, data = nemo_gby) #adding lat improves R2 by 0.001

summary(M100Y_lmg3b)
visreg(M100Y_lmg3b)
summary(M100Y_lmg4b)
visreg(M100Y_lmg4b)

#Interactions
M100Y_lmg3bi <- lm(DOY ~ MAT_100Y + MAP_100Y + geo_f + geo_f:MAT_100Y, data = nemo_gby)
#M100Y_lmg4bi <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year + geo_f + geo_f:MAT_100Y, data = nemo_gby) #No interaction here

summary(M100Y_lmg3bi)
visreg(M100Y_lmg3bi)
```


```{r warning = FALSE, message = FALSE, echo = FALSE, eval = FALSE}

ggplot(data = nemo_gby, aes(x = error_bin, by = geo_f)) + #Updated figure from EDA1.Rmd
  geom_bar(color = "black", aes(fill = geo_f), show.legend = FALSE) +
  theme_classic() +
  scale_y_continuous(expand = c(0,0), limits = c(0,800)) +
  ylab("Count") + 
  xlab("Error Distance (binned)") +
  scale_fill_manual(values = c("#0ba4e0", "#a3a3a3")) +
  labs(fill = "Independently Georeferenced")

ggsave(here::here("analyses", "figs1", "georef_errorbins.png"), height = 4, width = 6)
```


Appears that, as in above analyses, some aspect of georeference source (specimens we used GEOLocate to get coords for) results in a lower parameter estimate for temperature variables. 



Other potential biases due to georeferencer  
```{r warning = FALSE, message = FALSE,}
#DOY
geo_lmg <- lm(DOY ~ geo_f, data = nemo_gby)
anova(geo_lmg)

#lat/long
geo_lmg1a <- lm(long ~ geo_f, data = nemo_gby)
geo_lmg1b <- lm(lat ~ geo_f, data = nemo_gby)
anova(geo_lmg1a)
anova(geo_lmg1b)
visreg(geo_lmg1a) #wild pattern
visreg(geo_lmg1b)

#year
geo_lmg2 <- lm(year ~ geo_f, data = nemo_gby)
anova(geo_lmg2)
visreg(geo_lmg2)

#Elev_m
geo_lmg3 <- lm(elev_m ~ geo_f, data = nemo_gby)
anova(geo_lmg3)
visreg(geo_lmg3)

#MAT
geo_lmg4 <- lm(MAT_100Y ~ geo_f, data = nemo_gby)
anova(geo_lmg4)
visreg(geo_lmg4)

#MAP
geo_lmg5 <- lm(MAP_100Y ~ geo_f, data = nemo_gby)
anova(geo_lmg5)
visreg(geo_lmg5)


#Similar pattern as with subsetting - significant effect when only-climate predictors, disappears when geographical predictors added
```

Significant differences in georeferencer source *suggests*:  

- DOY earlier for geo_f = "y"  
- Geographic biasd in non-georeferenced records (lat, long, elev_m)  
- Year earlier for specimens we georeferenced  
- Elevation lower for specimens we georeferenced  
- MAT/temp cooler for geo_f = "y"  


These geographic differences are enlightening! Help explain why it appears that temperature may differ between groups of georeferenced specimens.  


### Other potential sources of noise aside from error distance or georeferenced location?  

------  


<br>  


## Investigating Collection Bias on the relatinoship between climate and DOY  


#### Year  
Are there certain years or period with significantly higher collections? Has collections increased or decreased through time?  

```{r warning = FALSE, message = FALSE}

cb_lm1 <- lm(DOY ~ year, data = nemo_df2)
summary(cb_lm1)


#Correlate YoC with DOY collection to look for temporal collecting trend (as in Panchen 2019)

year_cor <- cor(nemo_df2 %>% select(DOY, year))
year_cor
#No correlation b/w DOY and year

```

No significant effect of year on DOY.  

```{r warning = FALSE, message = FALSE, echo = FALSE, results = 'hide'}
#Recall the distribution of DOY

ggplot(aes(x = DOY), data = nemo_df2) +
  geom_histogram(fill = "blue", color = "black") + 
  scale_y_continuous(expand = c(0,0)) + 
  theme_classic()
```


```{r warning = FALSE, message = FALSE}
#Number of specimens in each year - ID periods of low and high collection
ggplot(aes(x = year), data = nemo_df1) +
  geom_bar(stat = 'count', width = 1, fill = "blue", color = "black") +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(limits = c(1850, 2020), expand = c(0,0)) +
  geom_vline(aes(xintercept = 1900), col = "red2", size = 1) +
  theme_classic()


#Parse by decade?

```


```{r warning = FALSE, message = FALSE, echo = FALSE, results = 'hide'}
# Month  
#Certain months preferred for collections? Check lat/long/elevation interactions  

cb_lm2 <- lm(DOY ~ month, data = nemo_df2)
summary(cb_lm2)
visreg(cb_lm2)


#No interacting effects. Not particularly surprising how strongly correlated DOY is to month...
nemo_df2_sz <- nemo_df2 %>% 
  mutate(M_window = case_when(month == "2" | month == "3" ~ "FM",
                              month == "4" | month == "5" ~ "AM",
                              month == "6" | month == "7" ~ "JJ")) #only a few NAs
cb_lm2a <- lm(DOY ~ M_window, data = nemo_df2_sz)
summary(cb_lm2a)


#Collection month over time:

cb_lm2b <- lm(month ~ year, data = nemo_df2)
summary(cb_lm2b)

cb_lm2c <- lm(!is.na(M_window) ~ year, data = nemo_df2_sz, na.action = na.omit)
summary(cb_lm2c)

#No shift in collection month (or period) over time

```

 


#### Location  
Are certain parts of the species range sampled more heavily (e.g. Southeast)? Across years?
Lat  
Long  


```{r warning = FALSE, message = FALSE, echo = FALSE}
library(corrplot)

corrplot(cor(nemo_df2 %>% select(lat, long, year, elev_m, DOY)))
#Use correlations to inform models ran
#No apparent effect of variables on year or vice versa

cb_lmy1a <- lm(long ~ year + lat, data = nemo_df2)
summary(cb_lmy1a) #No interactions present
visreg(cb_lmy1a)

cb_lmy1b <- lm(lat ~ year + long, data = nemo_df2)
summary(cb_lmy1b) #No interactions present, year ns
#visreg(cb_lmy1b)

cb_lmy2a <- lm(elev_m ~ year, data = nemo_df2)
summary(cb_lmy2a)
visreg(cb_lmy2a)


cb_lmy2b <- lm(elev_m ~ year + long, data = nemo_df2)
summary(cb_lmy2b) #no interaction
visreg(cb_lmy2b)

```

Over time, there appears to be relatively more collections made at more inland longitudes and at higher elevations. This could be do to greater collection efforts and greater accessibility to areas in more recent decades.  




*Option*:  
Spatial Collection Patterns (Panchen 2019)  
- calculate density of specimens per [2500 m x 2500 m pixel] using `geosphere` package [or .25deg x .25deg - Daru 2018, sp package]  
- model relationship of density and distance to community (raster package)  
- [test for spatial autocorrelation to detect a temporal*spatial trend]  





DOY as a response  
(This doesn't really address collection bias)     

```{r warning = FALSE, message = FALSE, echo = FALSE}
#Lat/long
cb_lm3a <- lm(DOY ~ lat, data = nemo_df2)
summary(cb_lm3a)
visreg(cb_lm3a)

cb_lm3b <- lm(DOY ~ long, data = nemo_df2)
summary(cb_lm3b)
visreg(cb_lm3b)

cb_lm4 <- lm(DOY ~ elev_m, data = nemo_df2)
summary(cb_lm4)
visreg(cb_lm4)


```


Multiple Variables:  
(Copied from 'EDA2.Rmd')  
```{r message = FALSE, warning = FALSE, echo = FALSE}
cbl_lm1 <- lm(DOY ~ elev_m + long + year, data = nemo_df1) #all years - similar to df2
cbl_lm1a <- lm(DOY ~ elev_m + long + year, data = nemo_df2) #>1900
summary(cbl_lm1a)
visreg(cbl_lm1a)



#Interactions
cbl_lm2a <- lm(DOY ~ elev_m + year*long*lat + MAT_100Y + MAP_100Y, data = nemo_df2)  
summary(cbl_lm2a) #No interactions w elevation
visreg(cbl_lm2a)

interact_plot(cbl_lm2a, pred = "year", modx = "long", mod2 = "lat") + theme_bw() #probably better? accounts for elev_m
ggsave(here::here("analyses", "figs1", "interactp1.png"), height = 4, width = 7)


cbl_lm2b <- lm(DOY ~ year*long*lat, data = nemo_df2)  
summary(cbl_lm2b) #No interactions w elevation
visreg(cbl_lm2b)

interact_plot(cbl_lm2b, pred = "year", modx = "long", mod2 = "lat") 


cbl_lm2c <- lm(DOY ~ elev_m + year*long, data = nemo_df2)  
summary(cbl_lm2c) #no year:long interaction


#No two-way interactions with year


#Check VIFs?
```


Geographic Collection Trends:  

```{r warning = FALSE, message = FALSE, echo = FALSE}
ggplot(aes(x = elev_m), data = nemo_df2) +
  geom_histogram(fill = "blue", color = "black", binwidth = 25) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  xlab("Elevation (m)") +
  theme_classic()

ggplot(aes(x = lat), data = nemo_df2) +
  geom_histogram(fill = "blue", color = "black") +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  xlab("Latitude") +
  theme_classic()

ggplot(aes(x = long), data = nemo_df2) +
  geom_histogram(fill = "blue", color = "black") +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  xlab("Longitude") +
  theme_classic()

```






#### Collector Bias  

Are there super-collectors who've collected a relatively large proportion of specimens?  
First name listed = primary collector (as in *Panchen 2019*)
- Sort primary collectors by # specimens collected. Top collectors = those who collected XX% (e.g. 90%) of all specimens  
- calculate % of collectors top collectors represent  
- (over time: correlate top collectors mean # collections per year ~ collectors' mean year of collecting)  
- (Mean DOY of top collectors - is it normally distributed? shapiro-wilks test. ID temporal biases)  

**or**  
[Via Daru 2018 - multi-spp study..]  
- Calculate # specimens for each collector  
- Is this skewed toward few collectors?  

```{r message = FALSE, warning = FALSE, echo = FALSE}
#Narrow down collector column to primary collectors
#Use nemo df1 - collections from all years

#1 - limit to first name - all characters before comma, ; , & 'and'
#Match whole words (last names only), everything before , or ;
nemo_df1_coll <- nemo_df1 %>% 
  mutate(collector_p1 = str_extract(collector, pattern = "[A-Za-z]+(?=(,|;|$))")) %>% 
  select(collector, collector_p1, everything())
  #Best method so far for extracting last names, not perfect - Would be better if there was a way to keep the initials? A few single collectors with ,/; only have first names. Last names seem pretty unique, though 2-3 Smiths & Bakers are lumped together

#works okay, only one name, sometimes first mutate(collector_p1 = str_extract(collector, pattern = "\\w+[[:space]]*[^[/., | /.;]]+")  
#Works okay mutate(collector_p1 = str_extract(collector, pattern = "[A-Z][a-z]{2,}"))

#Alternative: use similarity threshold? Would have to match initials/first letters of names and entire last names...

```


```{r message = FALSE, warning = FALSE, echo = FALSE}
coll_sums <- nemo_df1_coll %>% 
  select(collector_p1) %>% 
  group_by(collector_p1) %>% 
  summarize("Count" = n(), "Percent" = (100*n()/1764)) %>% 
  arrange(-Percent) %>% 
  mutate(top_col = case_when(Percent >= 1 ~ "y",
                             Percent < 1 ~ "n"))


head(coll_sums)
#Highest individual collection percent does not exceed 2.5% (2.6237% in nemo_df2)

#Assign top collectors as those who collected > 1% ##Is this too small?


#What percent of all collectors are top collectors?
100*count(coll_sums %>% filter(top_col == "y"))/count(coll_sums)

#Approx. 2.22%
```

Top collector contributions are very unlikely to have any meaningful bias on the data due to their very small sample sizes.  

```{r message = FALSE, warning = FALSE, echo = FALSE}
se <- function(x){
  sd(x)/sqrt(length(x))
}
#Investigate potential biases
#DOY
#Filter df to top collectors
nemo_df1_coll_top <- nemo_df1_coll %>% 
  filter(collector_p1 %in% c("Sanders", "Gander", "Swinney", "Munz", "Tracy", "Rebman", "Helmkamp", "Jepson", "Smith", "Boyd", "Chandler", "Wheeler", "Constance", "White", "Baker"))


ggplot(aes(x = DOY), data = nemo_df1_coll_top) +
  geom_histogram(fill = "blue", color = "black") + 
  scale_y_continuous(expand = c(0,0)) + 
  theme_bw() +
  facet_wrap(~collector_p1)

#Does not appear to be any bias in DOY due to collector!


#Check top collectors mean # of collections per year, and mean year of collections

coll_sums2 <- nemo_df1_coll_top %>% 
  select(collector_p1, DOY, year) %>% 
  group_by(collector_p1) %>% 
  summarize("Count" = n(), "Percent" = (100*n()/1764), "Year_M" = mean(year), "Year_SE" = se(year), "Year_Range" = paste(min(year),",", max(year)), "DOY_M" = mean(DOY), "DOY_SE" = se(DOY)) %>% #Smith & Baker will be erroneous - lumped collectors
  arrange(-Percent) 
  
head(coll_sums2)

sum(coll_sums2$Count) #Top collectors contributed 382 specimens
```


Compare subsetted data (or with collector as covariate) to og data in pheno-climatic models?  
Not sure this makes sense, top collectors contributed a large number of records
```{r message = FALSE, warning = FALSE, echo = FALSE}
nemo_df1_notop <- nemo_df1_coll %>% 
  filter(!collector_p1 %in% c("Sanders", "Gander", "Swinney", "Munz", "Tracy", "Rebman", "Helmkamp", "Jepson", "Smith", "Boyd", "Chandler", "Wheeler", "Constance", "White", "Baker"))

collb_lm1 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_df1) #Base data, with collector_p
collb_lm2 <- lm(DOY ~ MAT_100Y + MAP_100Y + elev_m + long + year, data = nemo_df1_notop)

summary(collb_lm1)
summary(collb_lm2)

plot_summs(collb_lm1, collb_lm2, model.names = c("All Records", "No top collectors"), scale = TRUE) + theme_bw()

```



### Trends in *N. menziesii* Subspecies  

Are certain subspecies collected from certain geographic regions?  
```{r warning = FALSE, message = FALSE, echo = FALSE}
#Geographic patterns in subspecies

## ? PLOT NAs as well?

sspb_lm1a <- lm(lat ~ sub_sp, data = nemo_df2)
summary(sspb_lm1a)
anova(sspb_lm1a)
visreg(sspb_lm1a)

sspb_lm1b <- lm(long ~ sub_sp, data = nemo_df2)
summary(sspb_lm1b)
anova(sspb_lm1b)
visreg(sspb_lm1b)

sspb_lm1c <- lm(elev_m ~ sub_sp, data = nemo_df2)
summary(sspb_lm1c)
anova(sspb_lm1c)
visreg(sspb_lm1c)


#
sspb_lm2a <- lm(long ~ sub_sp + lat + elev_m, data = nemo_df2)
summary(sspb_lm2a)
anova(sspb_lm2a)
visreg(sspb_lm2a)
```


```{r warning = FALSE, message = FALSE, echo = FALSE, eval = FALSE}
#Map of subspecies
library(sf)

ca_border <- read_sf(here::here("analyses", "ca_state_border"), layer = "CA_State_TIGER2016") # imports all files with prefix

nemo_sf <- st_as_sf(nemo_all1, crs = 4326, coords = c("long", "lat"))
clim_dfsf <- st_as_sf(climNA_all, crs = 4326, coords = c("long","lat"))


ggplot() +
  geom_sf(data = ca_border, fill = "#dfffd1") +
  geom_sf(data = clim_dfsf, aes(color = MAP_100Y), alpha = 0.8, size = 2, show.legend = TRUE) +
  labs(color = "MAP (mm)") +
  scale_color_gradientn(colors = c("#ade2ff", "#004063"), values = c(0, 1)) +
  theme_minimal()


```


```{r warning = FALSE, message = FALSE, echo = FALSE}
#Temporal patterns in subspecies
sspb_lm3a <- lm(DOY ~ sub_sp, data = nemo_df2)
summary(sspb_lm3a)
anova(sspb_lm3a)
visreg(sspb_lm3a)

sspb_lm3b <- lm(month ~ sub_sp, data = nemo_df2)
summary(sspb_lm3b)
anova(sspb_lm3b)
visreg(sspb_lm3b)

sspb_lm3c <- lm(year ~ sub_sp, data = nemo_df2)
summary(sspb_lm3c)
anova(sspb_lm3c)
visreg(sspb_lm3c)
```

From certain periods in time?  



#### Phenological stage [when PI scoring complete]  
Are certain phenophases (e.g. peak flowering) over-represented?  
(Are plants preferrentially collected during peak flowering) (Biases against v. early or late-stage phenophases)











